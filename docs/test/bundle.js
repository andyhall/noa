!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=26)}([function(t,e,n){t.exports={EPSILON:n(8),create:n(9),clone:n(28),angle:n(29),fromValues:n(10),copy:n(30),set:n(31),equals:n(32),exactEquals:n(33),add:n(34),subtract:n(13),sub:n(35),multiply:n(14),mul:n(36),divide:n(15),div:n(37),min:n(38),max:n(39),floor:n(40),ceil:n(41),round:n(42),scale:n(43),scaleAndAdd:n(44),distance:n(16),dist:n(45),squaredDistance:n(17),sqrDist:n(46),length:n(18),len:n(47),squaredLength:n(19),sqrLen:n(48),negate:n(49),inverse:n(50),normalize:n(11),dot:n(12),cross:n(51),lerp:n(52),random:n(53),transformMat4:n(54),transformMat3:n(55),transformQuat:n(56),rotateX:n(57),rotateY:n(58),rotateZ:n(59),forEach:n(60)}},function(t,e,n){"use strict";t.exports={Timer:function(t,e){var n=e||"",r=t||1,i=[],o=[],s=0,a=0,u=0,c=0,l=!0;this.start=function(){l&&(i.length=o.length=0,l=!1),s=a=performance.now(),u++},this.add=function(t){var e=performance.now();o.indexOf(t)<0&&o.push(t);var n=o.indexOf(t);i[n]||(i[n]=0),i[n]+=e-a,a=e},this.report=function(){if(c+=performance.now()-s,u===r){var t=n+" total "+(c/r).toFixed(2)+"ms (avg, "+r+" runs)    ";console.log(t,o.map(function(t,e){return t+": "+(i[e]/r).toFixed(2)+"ms    "}).join("")),l=!0,u=0,c=0}}},removeUnorderedListItem:function(t,e){var n=t.indexOf(e);if(n<0)return;n===t.length-1?t.pop():t[n]=t.pop()}}},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,s,a,u,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(o(n=this._events[t]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),s=(c=n.slice()).length,u=0;u<s;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(t,e){var s;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(s=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},n.prototype.removeListener=function(t,e){var n,o,s,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(n=this._events[t]).length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(a=s;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){t.exports=i;var r=n(0);function i(t,e){if(!(this instanceof i))return new i(t,e);var n=r.create();r.add(n,t,e),this.base=r.min(r.create(),t,n),this.vec=r.clone(e),this.max=r.max(r.create(),t,n),this.mag=r.length(this.vec)}var o=i.prototype;o.width=function(){return this.vec[0]},o.height=function(){return this.vec[1]},o.depth=function(){return this.vec[2]},o.x0=function(){return this.base[0]},o.y0=function(){return this.base[1]},o.z0=function(){return this.base[2]},o.x1=function(){return this.max[0]},o.y1=function(){return this.max[1]},o.z1=function(){return this.max[2]},o.translate=function(t){return r.add(this.max,this.max,t),r.add(this.base,this.base,t),this},o.setPosition=function(t){return r.add(this.max,t,this.vec),r.copy(this.base,t),this},o.expand=function(t){var e=r.create(),n=r.create();return r.max(e,t.max,this.max),r.min(n,t.base,this.base),r.subtract(e,e,n),new i(n,e)},o.intersects=function(t){return!(t.base[0]>this.max[0])&&(!(t.base[1]>this.max[1])&&(!(t.base[2]>this.max[2])&&(!(t.max[0]<this.base[0])&&(!(t.max[1]<this.base[1])&&!(t.max[2]<this.base[2])))))},o.touches=function(t){var e=this.union(t);return null!==e&&(0==e.width()||0==e.height()||0==e.depth())},o.union=function(t){if(!this.intersects(t))return null;var e=Math.max(t.base[0],this.base[0]),n=Math.max(t.base[1],this.base[1]),r=Math.max(t.base[2],this.base[2]);return new i([e,n,r],[Math.min(t.max[0],this.max[0])-e,Math.min(t.max[1],this.max[1])-n,Math.min(t.max[2],this.max[2])-r])}},function(t,e,n){var r=n(20),i=n(61),o="undefined"!=typeof Float64Array;function s(t,e){return t[0]-e[0]}function a(){var t,e=this.stride,n=new Array(e.length);for(t=0;t<n.length;++t)n[t]=[Math.abs(e[t]),t];n.sort(s);var r=new Array(n.length);for(t=0;t<r.length;++t)r[t]=n[t][1];return r}function u(t,e){var n=["View",e,"d",t].join("");e<0&&(n="View_Nil"+t);var i="generic"===t;if(-1===e){var o="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(o)()}if(0===e){o="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",o)(c[t][0])}o=["'use strict'"];var s=r(e),u=s.map(function(t){return"i"+t}),l="this.offset+"+s.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),h=s.map(function(t){return"b"+t}).join(","),f=s.map(function(t){return"c"+t}).join(",");o.push("function "+n+"(a,"+h+","+f+",d){this.data=a","this.shape=["+h+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),o.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+s.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===e?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),e<4?(o.push("function "+n+"_order(){"),2===e?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+n+"_set("+u.join(",")+",v){"),i?o.push("return this.data.set("+l+",v)}"):o.push("return this.data["+l+"]=v}"),o.push("proto.get=function "+n+"_get("+u.join(",")+"){"),i?o.push("return this.data.get("+l+")}"):o.push("return this.data["+l+"]}"),o.push("proto.index=function "+n+"_index(",u.join(),"){return "+l+"}"),o.push("proto.hi=function "+n+"_hi("+u.join(",")+"){return new "+n+"(this.data,"+s.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+s.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var p=s.map(function(t){return"a"+t+"=this.shape["+t+"]"}),d=s.map(function(t){return"c"+t+"=this.stride["+t+"]"});o.push("proto.lo=function "+n+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+p.join(",")+","+d.join(","));for(var m=0;m<e;++m)o.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");o.push("return new "+n+"(this.data,"+s.map(function(t){return"a"+t}).join(",")+","+s.map(function(t){return"c"+t}).join(",")+",b)}"),o.push("proto.step=function "+n+"_step("+u.join(",")+"){var "+s.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+s.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(m=0;m<e;++m)o.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");o.push("return new "+n+"(this.data,"+s.map(function(t){return"a"+t}).join(",")+","+s.map(function(t){return"b"+t}).join(",")+",c)}");var v=new Array(e),g=new Array(e);for(m=0;m<e;++m)v[m]="a[i"+m+"]",g[m]="b[i"+m+"]";o.push("proto.transpose=function "+n+"_transpose("+u+"){"+u.map(function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+v.join(",")+","+g.join(",")+",this.offset)}"),o.push("proto.pick=function "+n+"_pick("+u+"){var a=[],b=[],c=this.offset");for(m=0;m<e;++m)o.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+s.map(function(t){return"shape["+t+"]"}).join(",")+","+s.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(c[t],a)}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};t.exports=function(t,e,n,r){if(void 0===t)return(0,c.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var s=e.length;if(void 0===n){n=new Array(s);for(var a=s-1,l=1;a>=0;--a)n[a]=l,l*=e[a]}if(void 0===r)for(r=0,a=0;a<s;++a)n[a]<0&&(r-=(e[a]-1)*n[a]);for(var h=function(t){if(i(t))return"buffer";if(o)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}(t),f=c[h];f.length<=s+1;)f.push(u(h,f.length-1));return(0,f[s+1])(t,e,n,r)}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";(function(t,r){var i=n(7),o=n(104);t.__TYPEDARRAY_POOL||(t.__TYPEDARRAY_POOL={UINT8:o([32,0]),UINT16:o([32,0]),UINT32:o([32,0]),INT8:o([32,0]),INT16:o([32,0]),INT32:o([32,0]),FLOAT:o([32,0]),DOUBLE:o([32,0]),DATA:o([32,0]),UINT8C:o([32,0]),BUFFER:o([32,0])});var s="undefined"!=typeof Uint8ClampedArray,a=t.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=o([32,0])),a.BUFFER||(a.BUFFER=o([32,0]));var u=a.DATA,c=a.BUFFER;function l(t){if(t){var e=t.length||t.byteLength,n=i.log2(e);u[n].push(t)}}function h(t){t=i.nextPow2(t);var e=i.log2(t),n=u[e];return n.length>0?n.pop():new ArrayBuffer(t)}function f(t){return new Uint8Array(h(t),0,t)}function p(t){return new Uint16Array(h(2*t),0,t)}function d(t){return new Uint32Array(h(4*t),0,t)}function m(t){return new Int8Array(h(t),0,t)}function v(t){return new Int16Array(h(2*t),0,t)}function g(t){return new Int32Array(h(4*t),0,t)}function y(t){return new Float32Array(h(4*t),0,t)}function _(t){return new Float64Array(h(8*t),0,t)}function w(t){return s?new Uint8ClampedArray(h(t),0,t):f(t)}function b(t){return new DataView(h(t),0,t)}function k(t){t=i.nextPow2(t);var e=i.log2(t),n=c[e];return n.length>0?n.pop():new r(t)}e.free=function(t){if(r.isBuffer(t))c[i.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var e=t.length||t.byteLength,n=0|i.log2(e);u[n].push(t)}},e.freeUint8=e.freeUint16=e.freeUint32=e.freeInt8=e.freeInt16=e.freeInt32=e.freeFloat32=e.freeFloat=e.freeFloat64=e.freeDouble=e.freeUint8Clamped=e.freeDataView=function(t){l(t.buffer)},e.freeArrayBuffer=l,e.freeBuffer=function(t){c[i.log2(t.length)].push(t)},e.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return h(t);switch(e){case"uint8":return f(t);case"uint16":return p(t);case"uint32":return d(t);case"int8":return m(t);case"int16":return v(t);case"int32":return g(t);case"float":case"float32":return y(t);case"double":case"float64":return _(t);case"uint8_clamped":return w(t);case"buffer":return k(t);case"data":case"dataview":return b(t);default:return null}return null},e.mallocArrayBuffer=h,e.mallocUint8=f,e.mallocUint16=p,e.mallocUint32=d,e.mallocInt8=m,e.mallocInt16=v,e.mallocInt32=g,e.mallocFloat32=e.mallocFloat=y,e.mallocFloat64=e.mallocDouble=_,e.mallocUint8Clamped=w,e.mallocDataView=b,e.mallocBuffer=k,e.clearCache=function(){for(var t=0;t<32;++t)a.UINT8[t].length=0,a.UINT16[t].length=0,a.UINT32[t].length=0,a.INT8[t].length=0,a.INT16[t].length=0,a.INT32[t].length=0,a.FLOAT[t].length=0,a.DOUBLE[t].length=0,a.UINT8C[t].length=0,u[t].length=0,c[t].length=0}}).call(this,n(5),n(100).Buffer)},function(t,e,n){"use strict";"use restrict";function r(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=r,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var i=new Array(256);!function(t){for(var e=0;e<256;++e){var n=e,r=e,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;t[e]=r<<i&255}}(i),e.reverse=function(t){return i[255&t]<<24|i[t>>>8&255]<<16|i[t>>>16&255]<<8|i[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>r(t)+1}},function(t,e){t.exports=1e-6},function(t,e){t.exports=function(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}},function(t,e){t.exports=function(t,e,n){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=n,r}},function(t,e){t.exports=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o);return t}},function(t,e){t.exports=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}},function(t,e){t.exports=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}},function(t,e){t.exports=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}},function(t,e){t.exports=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}},function(t,e){t.exports=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}},function(t,e){t.exports=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}},function(t,e){t.exports=function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}},function(t,e){t.exports=function(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}},function(t,e,n){"use strict";t.exports=function(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=n;return e}},function(t,e,n){(function(t,r){var i=/%[sdj%]/g;e.format=function(t){if(!g(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(a(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,o=r.length,s=String(t).replace(i,function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),u=r[n];n<o;u=r[++n])m(u)||!w(u)?s+=" "+u:s+=" "+a(u);return s},e.deprecate=function(n,i){if(y(t.process))return function(){return e.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var o=!1;return function(){if(!o){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),o=!0}return n.apply(this,arguments)}};var o,s={};function a(t,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&e._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),l(r,t,r.depth)}function u(t,e){var n=a.styles[e];return n?"["+a.colors[n][0]+"m"+t+"["+a.colors[n][1]+"m":t}function c(t,e){return t}function l(t,n,r){if(t.customInspect&&n&&M(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,t);return g(i)||(i=l(t,i,r)),i}var o=function(t,e){if(y(e))return t.stylize("undefined","undefined");if(g(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(v(e))return t.stylize(""+e,"number");if(d(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,n);if(o)return o;var s=Object.keys(n),a=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(n)),k(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(n);if(0===s.length){if(M(n)){var u=n.name?": "+n.name:"";return t.stylize("[Function"+u+"]","special")}if(_(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return t.stylize(Date.prototype.toString.call(n),"date");if(k(n))return h(n)}var c,w="",x=!1,A=["{","}"];(p(n)&&(x=!0,A=["[","]"]),M(n))&&(w=" [Function"+(n.name?": "+n.name:"")+"]");return _(n)&&(w=" "+RegExp.prototype.toString.call(n)),b(n)&&(w=" "+Date.prototype.toUTCString.call(n)),k(n)&&(w=" "+h(n)),0!==s.length||x&&0!=n.length?r<0?_(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),c=x?function(t,e,n,r,i){for(var o=[],s=0,a=e.length;s<a;++s)B(e,String(s))?o.push(f(t,e,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(f(t,e,n,r,i,!0))}),o}(t,n,r,a,s):s.map(function(e){return f(t,n,r,a,e,x)}),t.seen.pop(),function(t,e,n){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(c,w,A)):A[0]+w+A[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,n,r,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),B(r,i)||(s="["+i+"]"),a||(t.seen.indexOf(u.value)<0?(a=m(n)?l(t,u.value,null):l(t,u.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),y(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function p(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function m(t){return null===t}function v(t){return"number"==typeof t}function g(t){return"string"==typeof t}function y(t){return void 0===t}function _(t){return w(t)&&"[object RegExp]"===x(t)}function w(t){return"object"==typeof t&&null!==t}function b(t){return w(t)&&"[object Date]"===x(t)}function k(t){return w(t)&&("[object Error]"===x(t)||t instanceof Error)}function M(t){return"function"==typeof t}function x(t){return Object.prototype.toString.call(t)}function A(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(y(o)&&(o=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=r.pid;s[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else s[t]=function(){};return s[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=d,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=v,e.isString=g,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=y,e.isRegExp=_,e.isObject=w,e.isDate=b,e.isError=k,e.isFunction=M,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(65);var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function B(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",function(){var t=new Date,e=[A(t.getHours()),A(t.getMinutes()),A(t.getSeconds())].join(":");return[t.getDate(),E[t.getMonth()],e].join(" ")}(),e.format.apply(e,arguments))},e.inherits=n(66),e._extend=function(t,e){if(!e||!w(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,n(5),n(64))},function(t,e,n){"use strict";var r=[],i=[],o=[],s=[],a=[],u=[],c=[],l=[],h=[],f=[],p=[],d=[];t.exports=function(t,e,n,m,v,g){for(var y=c,_=h,w=f,b=d,k=0;k<3;k++)y[k]=+n[k],w[k]=+e.max[k],_[k]=+e.base[k];g||(g=1e-10);var M=function(t,e,n,c,h,f){var d=r,m=i,v=o,g=s,y=a,_=u,w=l,b=Math.floor,k=0,M=0,x=0,A=0,E=0;if(B(),0===x)return 0;for(A=P();M<=x;){if(C(A)&&D())return k;A=P()}for(k+=x,E=0;E<3;E++)c[E]+=n[E],h[E]+=n[E];return k;function B(){if(M=0,0!==(x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])))for(var t=0;t<3;t++){var e=n[t]>=0;g[t]=e?1:-1;var r=e?h[t]:c[t];d[t]=e?c[t]:h[t],m[t]=S(r,g[t]),v[t]=L(d[t],g[t]),w[t]=n[t]/x,y[t]=Math.abs(1/w[t]);var i=e?m[t]+1-r:r-m[t];_[t]=y[t]<1/0?y[t]*i:1/0}}function C(e){for(var n=g[0],r=0===e?m[0]:v[0],i=m[0]+n,o=g[1],s=1===e?m[1]:v[1],a=m[1]+o,u=g[2],c=2===e?m[2]:v[2],l=m[2]+u,h=r;h!=i;h+=n)for(var f=s;f!=a;f+=o)for(var p=c;p!=l;p+=u)if(t(h,f,p))return!0;return!1}function D(){k+=M;var t=g[A],r=M/x,i=p;for(E=0;E<3;E++){var o=n[E]*r;c[E]+=o,h[E]+=o,i[E]=n[E]-o}if(t>0?h[A]=Math.round(h[A]):c[A]=Math.round(c[A]),e(k,A,t,i))return!0;for(E=0;E<3;E++)n[E]=i[E];return B(),0===x}function P(){var t=_[0]<_[1]?_[0]<_[2]?0:2:_[1]<_[2]?1:2,e=_[t]-M;for(M=_[t],m[t]+=g[t],_[t]+=y[t],E=0;E<3;E++)d[E]+=e*w[E],v[E]=L(d[E],g[E]);return t}function S(t,e){return b(t-e*f)}function L(t,e){return b(t+e*f)}}(t,m,y,_,w,g);if(!v){for(k=0;k<3;k++)b[k]=n[k]>0?w[k]-e.max[k]:_[k]-e.base[k];e.translate(b)}return M}},function(t,e,n){"use strict";var r={};t.exports=r;var i=13,o=1<<i++,s=1<<i++,a=1<<i++;r.ID_MASK=511,r.VAR_MASK=7680,r.SOLID_BIT=o,r.OPAQUE_BIT=s,r.OBJECT_BIT=a},function(t,e,n){"use strict";t.exports={init:function(t){var e=i.nextPow2(t);a.length<e&&(r.free(a),a=r.mallocInt32(e));u.length<e&&(r.free(u),u=r.mallocInt32(e));c.length<e&&(r.free(c),c=r.mallocInt32(e));l.length<e&&(r.free(l),l=r.mallocInt32(e));h.length<e&&(r.free(h),h=r.mallocInt32(e));f.length<e&&(r.free(f),f=r.mallocInt32(e));var n=8*e;p.length<n&&(r.free(p),p=r.mallocDouble(n))},sweepBipartite:function(t,e,n,r,i,h,f,v,g,y){for(var _=0,w=2*t,b=t-1,k=w-1,M=n;M<r;++M){var x=h[M],A=w*M;p[_++]=i[A+b],p[_++]=-(x+1),p[_++]=i[A+k],p[_++]=x}for(var M=f;M<v;++M){var x=y[M]+s,E=w*M;p[_++]=g[E+b],p[_++]=-x,p[_++]=g[E+k],p[_++]=x}var B=_>>>1;o(p,B);for(var C=0,D=0,M=0;M<B;++M){var P=0|p[2*M+1];if(P>=s)d(c,l,D--,P=P-s|0);else if(P>=0)d(a,u,C--,P);else if(P<=-s){P=-P-s|0;for(var S=0;S<C;++S){var L=e(a[S],P);if(void 0!==L)return L}m(c,l,D++,P)}else{P=-P-1|0;for(var S=0;S<D;++S){var L=e(P,c[S]);if(void 0!==L)return L}m(a,u,C++,P)}}},sweepComplete:function(t,e,n,r,i,s,v,g,y,_){for(var w=0,b=2*t,k=t-1,M=b-1,x=n;x<r;++x){var A=s[x]+1<<1,E=b*x;p[w++]=i[E+k],p[w++]=-A,p[w++]=i[E+M],p[w++]=A}for(var x=v;x<g;++x){var A=_[x]+1<<1,B=b*x;p[w++]=y[B+k],p[w++]=1|-A,p[w++]=y[B+M],p[w++]=1|A}var C=w>>>1;o(p,C);for(var D=0,P=0,S=0,x=0;x<C;++x){var L=0|p[2*x+1],T=1&L;if(x<C-1&&L>>1==p[2*x+3]>>1&&(T=2,x+=1),L<0){for(var I=-(L>>1)-1,O=0;O<S;++O){var R=e(h[O],I);if(void 0!==R)return R}if(0!==T)for(var O=0;O<D;++O){var R=e(a[O],I);if(void 0!==R)return R}if(1!==T)for(var O=0;O<P;++O){var R=e(c[O],I);if(void 0!==R)return R}0===T?m(a,u,D++,I):1===T?m(c,l,P++,I):2===T&&m(h,f,S++,I)}else{var I=(L>>1)-1;0===T?d(a,u,D--,I):1===T?d(c,l,P--,I):2===T&&d(h,f,S--,I)}}},scanBipartite:function(t,e,n,r,i,c,l,h,f,v,g,y){var _=0,w=2*t,b=e,k=e+t,M=1,x=1;r?x=s:M=s;for(var A=i;A<c;++A){var E=A+M,B=w*A;p[_++]=l[B+b],p[_++]=-E,p[_++]=l[B+k],p[_++]=E}for(var A=f;A<v;++A){var E=A+x,C=w*A;p[_++]=g[C+b],p[_++]=-E}var D=_>>>1;o(p,D);for(var P=0,A=0;A<D;++A){var S=0|p[2*A+1];if(S<0){var E=-S,L=!1;if(E>=s?(L=!r,E-=s):(L=!!r,E-=1),L)m(a,u,P++,E);else{var T=y[E],I=w*E,O=g[I+e+1],R=g[I+e+1+t];t:for(var j=0;j<P;++j){var F=a[j],z=w*F;if(!(R<l[z+e+1]||l[z+e+1+t]<O)){for(var U=e+2;U<t;++U)if(g[I+U+t]<l[z+U]||l[z+U+t]<g[I+U])continue t;var Y,N=h[F];if(void 0!==(Y=r?n(T,N):n(N,T)))return Y}}}}else d(a,u,P--,S-M)}},scanComplete:function(t,e,n,r,i,u,c,l,h,f,d){for(var m=0,v=2*t,g=e,y=e+t,_=r;_<i;++_){var w=_+s,b=v*_;p[m++]=u[b+g],p[m++]=-w,p[m++]=u[b+y],p[m++]=w}for(var _=l;_<h;++_){var w=_+1,k=v*_;p[m++]=f[k+g],p[m++]=-w}var M=m>>>1;o(p,M);for(var x=0,_=0;_<M;++_){var A=0|p[2*_+1];if(A<0){var w=-A;if(w>=s)a[x++]=w-s;else{var E=d[w-=1],B=v*w,C=f[B+e+1],D=f[B+e+1+t];t:for(var P=0;P<x;++P){var S=a[P],L=c[S];if(L===E)break;var T=v*S;if(!(D<u[T+e+1]||u[T+e+1+t]<C)){for(var I=e+2;I<t;++I)if(f[B+I+t]<u[T+I]||u[T+I+t]<f[B+I])continue t;var O=n(L,E);if(void 0!==O)return O}}}}else{for(var w=A-s,P=x-1;P>=0;--P)if(a[P]===w){for(var I=P+1;I<x;++I)a[I-1]=a[I];break}--x}}}};var r=n(6),i=n(7),o=n(105),s=1<<28,a=r.mallocInt32(1024),u=r.mallocInt32(1024),c=r.mallocInt32(1024),l=r.mallocInt32(1024),h=r.mallocInt32(1024),f=r.mallocInt32(1024),p=r.mallocDouble(8192);function d(t,e,n,r){var i=e[r],o=t[n-1];t[i]=o,e[o]=i}function m(t,e,n,r){t[n]=r,e[r]=n}},function(t,e,n){"use strict";t.exports=function(t,e){var n="abcdef".split("").concat(e),i=[];t.indexOf("lo")>=0&&i.push("lo=e[k+n]");t.indexOf("hi")>=0&&i.push("hi=e[k+o]");return n.push(r.replace("_",i.join()).replace("$",t)),Function.apply(void 0,n)};var r="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},function(t,e,n){"use strict";var r=n(27)({debug:!0,showFPS:!0,inverseY:!0,chunkSize:32,chunkAddDistance:2,chunkRemoveDistance:3,blockTestDistance:50,texturePath:"textures/",playerStart:[.5,5,.5],playerHeight:1.4,playerWidth:.6,playerAutoStep:!0,useAO:!0,AOmultipliers:[.92,.8,.5],reverseAOmultiplier:1}),i=[.45,.36,.22];r.registry.registerMaterial("grass",[.1,.8,.2],null),r.registry.registerMaterial("dirt",i,null,!1);for(var o=["a","b","c","d","1","2"],s=0;s<6;s++){var a=o[s];r.registry.registerMaterial(a,null,a+".png"),r.registry.registerMaterial("t"+a,null,"t"+a+".png",!0)}r.registry.registerMaterial("water",[.5,.5,.8,.7],null);var u=r.rendering.makeStandardMaterial("shinyDirtMat");u.specularColor.copyFromFloats(1,1,1),u.specularPower=32,u.bumpTexture=new BABYLON.Texture("textures/stone.png",B),r.registry.registerMaterial("shinyDirt",i,null,!1,u);var c=BABYLON.Mesh.CreateBox("b",1,r.rendering.getScene()),l=BABYLON.Matrix.Scaling(.2,1,.2);l.setTranslation(new BABYLON.Vector3(0,.5,0)),c.bakeTransformIntoVertices(l);var h=1,f=r.registry.registerBlock(h++,{material:"dirt"}),p=r.registry.registerBlock(h++,{material:"shinyDirt"}),d=r.registry.registerBlock(h++,{material:"grass"}),m=r.registry.registerBlock(h++,{material:["b","d","1","2","c","a"]}),v=r.registry.registerBlock(h++,{material:["tb","td","t1","t2","tc","ta"],opaque:!1}),g=r.registry.registerBlock(h++,{material:["1","2","a"]}),y=r.registry.registerBlock(h++,{material:"water",fluid:!0}),_=r.registry.registerBlock(h++,{blockMesh:c,opaque:!1,onCustomMeshCreate:function(t,e,n,r){t.rotation.y=(1.234*(e+.234)+6.78*(r+.567))%(2*Math.PI)}});function w(t,e){return.8+2*Math.sin(t/10)+(.4+2*Math.sin(e/15+t/30))}function b(t,e,n,r){if(t>0&&n>0){var i=1;return 63!=n&&63!=t||(i=20),e<i?d:0}return e<r?e<0?f:d:e<1?y:0}function k(t,e,n,i){for(var o=0;o<t;o++)r.setBlock(i,e+o,1,n+o),r.setBlock(i,2*t+e-o,1,n+o)}r.world.on("worldDataNeeded",function(t,e,n,i,o){for(var s=0;s<e.shape[0];++s)for(var a=0;a<e.shape[2];++a)for(var u=w(n+s,o+a),c=0;c<e.shape[1];++c){var l=b(n+s,i+c,o+a,u);l&&e.set(s,c,a,l)}r.world.setChunkData(t,e)}),setTimeout(function(){!function(){r.setBlock(m,-6,5,6),r.setBlock(v,-4,5,6),r.setBlock(g,-2,5,6);var t=5;k(10,5,t,p),k(10,5,t+2,f),k(10,5,t+5,f),k(10,5,t+9,f),k(10,5,t+14,f),k(10,5,t+=18,_),k(10,5,t+2,_),k(10,5,t+5,_),k(10,5,t+9,_),k(10,5,t+14,_)}()},1e3);var M=r.playerEntity,x=r.entities.getPositionData(M),A=x.width,E=x.height,B=r.rendering.getScene();(c=BABYLON.Mesh.CreateBox("player",1,B)).scaling.x=c.scaling.z=A,c.scaling.y=E;var C=[0,E/2,0];r.entities.addComponent(M,r.entities.names.mesh,{mesh:c,offset:C}),r.inputs.down.on("fire",function(){r.targetedBlock&&r.setBlock(0,r.targetedBlock.position)}),r.inputs.down.on("alt-fire",function(){r.targetedBlock&&r.addBlock(D,r.targetedBlock.adjacent)});var D=d;r.inputs.down.on("mid-fire",function(){r.targetedBlock&&(D=r.targetedBlock.blockID)});var P=0;r.on("afterRender",function(t){var e=r.inputs.state.scrolly;0!==e&&((P+=e>0?1:-1)<0&&(P=0),P>10&&(P=10),r.rendering.zoomDistance=P)}),r.inputs.bind("pause","P"),r.inputs.down.on("pause",function(){S=!S,r.setPaused(S)});var S=!1;r.inputs.bind("swap-world","O"),r.inputs.down.on("swap-world",function(){(function(t){f=t?2:1,d=t?1:2})(L=!L),r.world.invalidateAllChunks()});var L=!1},function(t,e,n){"use strict";var r=n(0),i=n(4),o=n(2).EventEmitter,s=n(62),a=n(75),u=n(76),c=n(81),l=n(85),h=n(88),f=n(89),p=n(90),d=n(113);t.exports=v;var m={debug:!1,playerHeight:1.8,playerWidth:.6,playerStart:[0,10,0],playerAutoStep:!1,tickRate:33,blockTestDistance:10,stickyPointerLock:!0,dragCameraOutsidePointerLock:!0,skipDefaultHighlighting:!1};function v(t){if(!(this instanceof v))return new v(t);t=Object.assign({},m,t),this._tickRate=t.tickRate,this._paused=!1,this._dragOutsideLock=t.dragCameraOutsidePointerLock;var e=this;this.container=s(this,t),this.inputs=c(this,t,this.container.element),this.registry=f(this,t),this.world=u(this,t),this.rendering=a(this,t,this.container.canvas),this.entities=p(this,t),this.ents=this.entities,this.physics=l(this,t),this.cameraControls=h(this,t);var n=this.ents;this.playerEntity=n.add(t.playerStart,t.playerWidth,t.playerHeight,null,null,!0,!0),n.addComponent(this.playerEntity,n.names.collideTerrain),n.addComponent(this.playerEntity,n.names.collideEntities);var o=n.getPhysicsBody(this.playerEntity);o.gravityMultiplier=2,o.autoStep=t.playerAutoStep,this.playerBody=o,n.addComponent(this.playerEntity,n.names.receivesInputs),n.addComponent(this.playerEntity,n.names.fadeOnZoom);if(n.addComponent(this.playerEntity,n.names.movement,{airJumps:1}),this.playerEyeOffset=.9*t.playerHeight,this.blockTestDistance=t.blockTestDistance||10,this.blockTargetIdCheck=this.registry.getBlockSolidity,this.targetedBlock=null,t.skipDefaultHighlighting||(this.defaultBlockHighlightFunction=function(t){t?e.rendering.highlightBlockFace(!0,t.position,t.normal):e.rendering.highlightBlockFace(!1)},this.on("targetBlockChanged",this.defaultBlockHighlightFunction)),this.rendering.initScene(),t.debug){window.noa=this,window.scene=this.rendering._scene,window.ndarray=i,window.vec3=r;var d=!1;this.inputs.bind("debug","Z"),this.inputs.down.on("debug",function(){(d=!d)?window.scene.debugLayer.show():window.scene.debugLayer.hide()})}}v.prototype=Object.create(o.prototype),v.prototype.tick=function(){if(!this._paused){k("start");var t=this._tickRate;this.world.tick(t),k("world"),this.world.playerChunkLoaded?(this.physics.tick(t),k("physics"),this.rendering.tick(t),k("rendering"),function(t){var e="",n=t.blockTargetIdCheck||t.registry.getBlockSolidity,r=t.pick(null,null,null,n);if(r){for(var i=w,o=0;o<3;o++){var s=0|r.normal[o],a=Math.floor(r.position[o]);i.position[o]=a,i.normal[o]=s,i.adjacent[o]=a+s,e+="|"+a+"|"+s}i.blockID=t.world.getBlockID(i.position[0],i.position[1],i.position[2]),e+="|"+r.blockID,t.targetedBlock=i}else t.targetedBlock=null;e!=b&&(t.emit("targetBlockChanged",t.targetedBlock),b=e)}(this),k("targets"),this.emit("tick",t),k("tick event"),k("end")):this.rendering.tick(t)}};v.prototype.render=function(t){if(!this._paused){M("start");var e=t*this._tickRate;(this.container.hasPointerLock||!this.container.supportsPointerLock||this._dragOutsideLock&&this.inputs.state.fire)&&this.cameraControls.updateForRender(),this.inputs.state.dx=this.inputs.state.dy=0,this.emit("beforeRender",e),M("before render"),this.rendering.render(e),M("render"),this.emit("afterRender",e),M("after render"),M("end"),this.inputs.tick()}},v.prototype.setPaused=function(t){this._paused=!!t,t||(this.inputs.state.dx=this.inputs.state.dy=0)},v.prototype.getBlock=function(t,e,n){return t.length?this.world.getBlockID(t[0],t[1],t[2]):this.world.getBlockID(t,e,n)},v.prototype.setBlock=function(t,e,n,r){return e.length?this.world.setBlockID(t,e[0],e[1],e[2]):this.world.setBlockID(t,e,n,r)},v.prototype.addBlock=function(t,e,n,r){if(e.length){if(this.entities.isTerrainBlocked(e[0],e[1],e[2]))return;this.world.setBlockID(t,e[0],e[1],e[2])}else{if(this.entities.isTerrainBlocked(e,n,r))return;this.world.setBlockID(t,e,n,r)}},v.prototype.getPlayerPosition=function(){return this.entities.getPosition(this.playerEntity)},v.prototype.getPlayerMesh=function(){return this.entities.getMeshData(this.playerEntity).mesh},v.prototype.setPlayerEyeOffset=function(t){this.playerEyeOffset=t,this.ents.getState(this.rendering.cameraTarget,this.ents.names.followsEntity).offset[1]=t},v.prototype.getPlayerEyePosition=function(){var t=this.entities.getPosition(this.playerEntity);return r.copy(g,t),g[1]+=this.playerEyeOffset,g};var g=r.create();v.prototype.getCameraVector=function(){var t=this.rendering.getCameraVector();return r.set(y,t.x,t.y,t.z),y};var y=r.create();v.prototype.pick=function(t,e,n,r){if(0===n)return null;var i=r||this.registry.getBlockSolidity,o=this.world;t=t||this.getPlayerEyePosition(),e=e||this.getCameraVector(),n=n||this.blockTestDistance;var s=_.position,a=_.normal;if(!d(function(t,e,n){var r=o.getBlockID(t,e,n);return i(r)},t,e,n,s,a))return null;for(var u=0;u<3;u++)s[u]-=.01*a[u];return _};var _={position:r.create(),normal:r.create()};var w={blockID:0,position:[],normal:[],adjacent:[]},b="",k=function(t){},M=function(t){}},function(t,e){t.exports=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}},function(t,e,n){t.exports=function(t,e){var n=r(t[0],t[1],t[2]),s=r(e[0],e[1],e[2]);i(n,n),i(s,s);var a=o(n,s);return a>1?0:Math.acos(a)};var r=n(10),i=n(11),o=n(12)},function(t,e){t.exports=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}},function(t,e){t.exports=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}},function(t,e,n){t.exports=function(t,e){var n=t[0],i=t[1],o=t[2],s=e[0],a=e[1],u=e[2];return Math.abs(n-s)<=r*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=r*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-u)<=r*Math.max(1,Math.abs(o),Math.abs(u))};var r=n(8)},function(t,e){t.exports=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}},function(t,e){t.exports=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}},function(t,e,n){t.exports=n(13)},function(t,e,n){t.exports=n(14)},function(t,e,n){t.exports=n(15)},function(t,e){t.exports=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}},function(t,e){t.exports=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}},function(t,e){t.exports=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}},function(t,e){t.exports=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}},function(t,e){t.exports=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}},function(t,e){t.exports=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}},function(t,e){t.exports=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}},function(t,e,n){t.exports=n(16)},function(t,e,n){t.exports=n(17)},function(t,e,n){t.exports=n(18)},function(t,e,n){t.exports=n(19)},function(t,e){t.exports=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}},function(t,e){t.exports=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}},function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2];return t[0]=i*u-o*a,t[1]=o*s-r*u,t[2]=r*a-i*s,t}},function(t,e){t.exports=function(t,e,n,r){var i=e[0],o=e[1],s=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t}},function(t,e){t.exports=function(t,e){e=e||1;var n=2*Math.random()*Math.PI,r=2*Math.random()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}},function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return s=s||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/s,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,t}},function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}},function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2],c=n[3],l=c*r+a*o-u*i,h=c*i+u*r-s*o,f=c*o+s*i-a*r,p=-s*r-a*i-u*o;return t[0]=l*c+p*-s+h*-u-f*-a,t[1]=h*c+p*-a+f*-s-l*-u,t[2]=f*c+p*-u+l*-a-h*-s,t}},function(t,e){t.exports=function(t,e,n,r){var i=n[1],o=n[2],s=e[1]-i,a=e[2]-o,u=Math.sin(r),c=Math.cos(r);return t[0]=e[0],t[1]=i+s*c-a*u,t[2]=o+s*u+a*c,t}},function(t,e){t.exports=function(t,e,n,r){var i=n[0],o=n[2],s=e[0]-i,a=e[2]-o,u=Math.sin(r),c=Math.cos(r);return t[0]=i+a*u+s*c,t[1]=e[1],t[2]=o+a*c-s*u,t}},function(t,e){t.exports=function(t,e,n,r){var i=n[0],o=n[1],s=e[0]-i,a=e[1]-o,u=Math.sin(r),c=Math.cos(r);return t[0]=i+s*c-a*u,t[1]=o+s*u+a*c,t[2]=e[2],t}},function(t,e,n){t.exports=function(t,e,n,i,o,s){var a,u;e||(e=3);n||(n=0);u=i?Math.min(i*e+n,t.length):t.length;for(a=n;a<u;a+=e)r[0]=t[a],r[1]=t[a+1],r[2]=t[a+2],o(r,r,s),t[a]=r[0],t[a+1]=r[1],t[a+2]=r[2];return t};var r=n(9)()},function(t,e){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&(n(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e,n){"use strict";var r=n(63),i=n(2).EventEmitter;function o(t,e){e=e||{},this._noa=t,this.element=e.domElement||function(){var t=document.createElement("div");return t.tabindex=1,t.style.position="absolute",t.style.left="0px",t.style.right="0px",t.style.top="0px",t.style.bottom="0px",t.style.height="100%",t.style.overflow="hidden",document.body.appendChild(t),document.body.style.overflow="hidden",document.body.style.height="100%",t.id="noa-container",t}(),this.canvas=function(t){var e=t.querySelector("canvas");e||((e=document.createElement("canvas")).style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.height="100%",e.style.width="100%",e.id="noa-canvas",t.insertBefore(e,t.firstChild));return e}(this.element),this._shell=function(t,e){(e=Object.assign({pointerLock:!0,preventDefaults:!1},e)).element=t;var n=r(e);return n.preventDefaults=e.preventDefaults,n}(this.canvas,e),this.hasPointerLock=!1,this.supportsPointerLock=!1,this.pointerInGame=!1,this.isFocused=document.hasFocus();var n=this,i=function(t){!function(t,e){var n=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement;n?(t.hasPointerLock=!0,t.emit("gainedPointerLock")):(t.hasPointerLock=!1,t.emit("lostPointerLock"));n&&(t.pointerInGame=!0)}(n)};document.addEventListener("pointerlockchange",i,!1),document.addEventListener("mozpointerlockchange",i,!1),document.addEventListener("webkitpointerlockchange",i,!1),function(t){if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){t.supportsPointerLock=!0;var e=function(n){t.supportsPointerLock=!1,document.removeEventListener(n.type,e)};document.addEventListener("touchmove",e)}}(n),n.element.addEventListener("mouseenter",function(){n.pointerInGame=!0}),n.element.addEventListener("mouseleave",function(){n.pointerInGame=!1}),window.addEventListener("focus",function(){n.isFocused=!0}),window.addEventListener("blur",function(){n.isFocused=!1}),this._shell.on("init",function(t){var e=t._noa,n=t._shell;n.on("tick",function(t){e.tick(t)}),n.on("render",function(t){e.render(t)}),n.on("resize",e.rendering.resize.bind(e.rendering)),t.emit("DOMready")}.bind(null,this))}t.exports=function(t,e){return new o(t,e)},o.prototype=Object.create(i.prototype),o.prototype.appendTo=function(t){this.element.appendChild(t)},o.prototype.setPointerLock=function(t){this._shell.pointerLock=!!t}},function(t,e,n){"use strict";var r=n(2).EventEmitter,i=n(21),o=n(67),s=n(68),a=n(69),u=n(70),c=n(71),l=n(20),h=Math.min;n(72);var f=n(73),p=n(74),d=function(){var t,e,n=new Array(256);for(t=0;t<256;++t)n[t]="UNK";for(t in s)"<"===(e=s[t]).charAt(0)&&">"===e.charAt(e.length-1)&&(e=e.substring(1,e.length-1)),e=e.replace(/\s/g,"-"),n[parseInt(t)]=e;return n}(),m=u(Object.keys(a(d)));function v(t){return c.eq(m,t)}function g(t){return v(d[t])}function y(){r.call(this),this._curKeyState=new Array(m.length),this._pressCount=new Array(m.length),this._releaseCount=new Array(m.length),this._tickInterval=null,this._rafHandle=null,this._tickRate=0,this._lastTick=p(),this._frameTime=0,this._paused=!0,this._width=0,this._height=0,this._wantFullscreen=!1,this._wantPointerLock=!1,this._fullscreenActive=!1,this._pointerLockActive=!1,this._rafFunction=A.bind(void 0,this,!0),this.preventDefaults=!0,this.stopPropagation=!1;for(var t=0;t<m.length;++t)this._curKeyState[t]=!1,this._pressCount[t]=this._releaseCount[t]=0;this.element=null,this.bindings={},this.frameSkip=100,this.tickCount=0,this.frameCount=0,this.startTime=p(),this.tickTime=this._tickRate,this.frameTime=10,this.stickyFullscreen=!1,this.stickyPointerLock=!1,this.scroll=[0,0,0],this.mouseX=0,this.mouseY=0,this.prevMouseX=0,this.prevMouseY=0}i.inherits(y,r);var _=y.prototype;function w(t,e,n){if(n in e){for(var r=e[n],i=0,o=0,s=r.length;o<s;++o)i+=t[v(r[o])];return i}var a=v(n);return a>=0?t[a]:0}function b(t){var e=t.element;t._wantFullscreen&&!t._fullscreenActive&&(e.requestFullscreen||e.requestFullScreen||e.webkitRequestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullscreen||e.mozRequestFullScreen||function(){}).call(e);t._wantPointerLock&&!t._pointerLockActive&&(e.requestPointerLock||e.webkitRequestPointerLock||e.mozRequestPointerLock||e.msRequestPointerLock||e.oRequestPointerLock||function(){}).call(e)}_.keyNames=m,_.bind=function(t){var e,n;e=t in this.bindings?this.bindings[t]:[];for(var r=1,i=arguments.length;r<i;++r)if(v(n=arguments[r])>=0)e.push(n);else if(n in this.bindings)for(var o=this.bindings[n],s=0;s<o.length;++s)e.push(o[s]);(e=u(e)).length>0&&(this.bindings[t]=e),this.emit("bind",t,e)},_.unbind=function(t){t in this.bindings&&delete this.bindings[t],this.emit("unbind",t)},_.down=function(t){return function(t,e,n){if(n in e){for(var r=e[n],i=0,o=r.length;i<o;++i)if(t[v(r[i])])return!0;return!1}var s=v(n);return s>=0&&t[s]}(this._curKeyState,this.bindings,t)},_.wasDown=function(t){return this.down(t)||!!this.press(t)},_.up=function(t){return!this.down(t)},_.wasUp=function(t){return this.up(t)||!!this.release(t)},_.press=function(t){return w(this._pressCount,this.bindings,t)},_.release=function(t){return w(this._releaseCount,this.bindings,t)},Object.defineProperty(_,"paused",{get:function(){return this._paused},set:function(t){!!t!==this._paused&&(this._paused?(this._paused=!1,this._lastTick=p()-Math.floor(this._frameTime*this._tickRate),this._tickInterval=setInterval(A,this._tickRate,this,!1),this._rafHandle=requestAnimationFrame(this._rafFunction)):(this._paused=!0,this._frameTime=h(1,(p()-this._lastTick)/this._tickRate),clearInterval(this._tickInterval)))}});var k=document.exitFullscreen||document.cancelFullscreen||document.cancelFullScreen||document.webkitCancelFullscreen||document.webkitCancelFullScreen||document.mozCancelFullscreen||document.mozCancelFullScreen||function(){};Object.defineProperty(_,"fullscreen",{get:function(){return this._fullscreenActive},set:function(t){return!!t?(this._wantFullscreen=!0,b(this)):(this._wantFullscreen=!1,k.call(document)),this._fullscreenActive}});var M=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock||function(){};function x(t,e,n){t._curKeyState[e]!==n&&(n?t._pressCount[e]++:t._releaseCount[e]++,t._curKeyState[e]=n)}function A(t,e){!function(t){var e,n,r,i=p()+t.frameSkip,o=t._pressCount,s=t._releaseCount,a=t._tickRate,u=m.length;for(;!t._paused&&p()>=t._lastTick+a;){if(p()>i)return void(t._lastTick=p()+a);for(n=p(),t.emit("tick"),r=p(),t.tickTime=r-n,++t.tickCount,t._lastTick+=a,e=0;e<u;++e)o[e]=s[e]=0;t._pointerLockActive?(t.prevMouseX=t.mouseX=t.width>>1,t.prevMouseY=t.mouseY=t.height>>1):(t.prevMouseX=t.mouseX,t.prevMouseY=t.mouseY),t.scroll[0]=t.scroll[1]=t.scroll[2]=0}}(t),e&&function(t){var e;t._rafHandle=requestAnimationFrame(t._rafFunction),e=t._paused?t._frameTime:h(1,(p()-t._lastTick)/t._tickRate);++t.frameCount;var n=p();t.emit("render",e);var r=p();t.frameTime=r-n}(t)}function E(t,e){t.preventDefaults&&e.preventDefault(),t.stopPropagation&&e.stopPropagation()}function B(t,e){if(function(t){return document.activeElement===document.body||document.activeElement===t.element}(t))if(E(t,e),e.metaKey)P(t,e);else{var n=g(e.keyCode||e.char||e.which||e.charCode);n>=0&&x(t,n,!0)}}Object.defineProperty(_,"pointerLock",{get:function(){return this._pointerLockActive},set:function(t){return!!t?(this._wantPointerLock=!0,b(this)):(this._wantPointerLock=!1,M.call(document)),this._pointerLockActive}}),Object.defineProperty(_,"width",{get:function(){return this.element.clientWidth}}),Object.defineProperty(_,"height",{get:function(){return this.element.clientHeight}});var C=l(32).map(function(t){return v("mouse-"+(t+1))});function D(t,e){return E(t,e),function(t,e){for(var n=0;n<32;++n)x(t,C[n],!!(e&1<<n))}(t,0),!1}function P(t,e){var n,r=m.length,i=t._curKeyState,o=t._releaseCount;for(n=0;n<r;++n)i[n]&&++o[n],i[n]=!1;return!1}function S(){var t=document.createElement("div");return t.tabindex=1,t.style.position="absolute",t.style.left="0px",t.style.right="0px",t.style.top="0px",t.style.bottom="0px",t.style.height="100%",t.style.overflow="hidden",document.body.appendChild(t),document.body.style.overflow="hidden",document.body.style.height="100%",t}t.exports=function(t){var e=!!(t=t||{}).fullscreen,n=e;void 0!==typeof t.pointerLock&&(n=!!t.pointerLock);var r=new y;return r._tickRate=t.tickRate||30,r.frameSkip=t.frameSkip||5*(r._tickRate+5),r.stickyFullscreen=!!t.stickyFullscreen||!!t.sticky,r.stickyPointerLock=!!t.stickyPointerLock||!!t.sticky,t.bindings&&(r.bindings=t.bindings),setTimeout(function(){o(function(){var i=t.element;if("string"==typeof i){var o=document.querySelector(i);o||(o=document.getElementById(i)),o||(o=document.getElementByClass(i)[0]),o||(o=S()),r.element=o}else r.element="object"==typeof i&&i?i:"function"==typeof i?i():S();r.element.style&&(r.element.style["-webkit-touch-callout"]="none",r.element.style["-webkit-user-select"]="none",r.element.style["-khtml-user-select"]="none",r.element.style["-moz-user-select"]="none",r.element.style["-ms-user-select"]="none",r.element.style["user-select"]="none"),r._width=r.element.clientWidth,r._height=r.element.clientHeight;var s=function(t,e){var n=0|t.element.clientWidth,r=0|t.element.clientHeight;n===t._width&&r===t._height||(t._width=n,t._height=r,t.emit("resize",n,r))}.bind(void 0,r);"undefined"!=typeof MutationObserver?new MutationObserver(s).observe(r.element,{attributes:!0,subtree:!0}):r.element.addEventListener("DOMSubtreeModified",s,!1),window.addEventListener("resize",s,!1),window.addEventListener("keydown",B.bind(void 0,r),!1),window.addEventListener("keyup",function(t,e){E(t,e);var n=g(e.keyCode||e.char||e.which||e.charCode);n>=0&&x(t,n,!1)}.bind(void 0,r),!1),r.element.oncontextmenu=function(t,e){return E(t,e),!1}.bind(void 0,r),r.element.addEventListener("mousedown",function(t,e){return E(t,e),x(t,C[e.button],!0),!1}.bind(void 0,r),!1),r.element.addEventListener("mouseup",function(t,e){return E(t,e),x(t,C[e.button],!1),!1}.bind(void 0,r),!1),r.element.addEventListener("mousemove",function(t,e){if(E(t,e),t._pointerLockActive){var n=e.movementX||e.mozMovementX||e.webkitMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||0;t.mouseX+=n,t.mouseY+=r}else t.mouseX=e.clientX-t.element.offsetLeft,t.mouseY=e.clientY-t.element.offsetTop;return!1}.bind(void 0,r),!1),r.element.addEventListener("mouseenter",function(t,e){return E(t,e),t._pointerLockActive?(t.prevMouseX=t.mouseX=t.width>>1,t.prevMouseY=t.mouseY=t.height>>1):(t.prevMouseX=t.mouseX=e.clientX-t.element.offsetLeft,t.prevMouseY=t.mouseY=e.clientY-t.element.offsetTop),!1}.bind(void 0,r),!1);var a=D.bind(void 0,r);r.element.addEventListener("mouseleave",a,!1),r.element.addEventListener("mouseout",a,!1),window.addEventListener("mouseleave",a,!1),window.addEventListener("mouseout",a,!1);var u=P.bind(void 0,r);r.element.addEventListener("blur",u,!1),r.element.addEventListener("focusout",u,!1),r.element.addEventListener("focus",u,!1),window.addEventListener("blur",u,!1),window.addEventListener("focusout",u,!1),window.addEventListener("focus",u,!1),f(r.element,function(t,e){E(t,e);var n=1;switch(e.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=t.height}return t.scroll[0]+=e.deltaX*n,t.scroll[1]+=e.deltaY*n,t.scroll[2]+=e.deltaZ*n||0,!1}.bind(void 0,r),!1);var c=function(t){t._fullscreenActive=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||!1,!t.stickyFullscreen&&t._fullscreenActive&&(t._wantFullscreen=!1)}.bind(void 0,r);document.addEventListener("fullscreenchange",c,!1),document.addEventListener("mozfullscreenchange",c,!1),document.addEventListener("webkitfullscreenchange",c,!1),r.element.addEventListener("click",b.bind(void 0,r),!1);var l=function(t,e){t._pointerLockActive=t.element===(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||null),!t.stickyPointerLock&&t._pointerLockActive&&(t._wantPointerLock=!1)}.bind(void 0,r);document.addEventListener("pointerlockchange",l,!1),document.addEventListener("mozpointerlockchange",l,!1),document.addEventListener("webkitpointerlockchange",l,!1),document.addEventListener("pointerlocklost",l,!1),document.addEventListener("webkitpointerlocklost",l,!1),document.addEventListener("mozpointerlocklost",l,!1),r.fullscreen=e,r.pointerLock=n,r.bind("mouse-left","mouse-1"),r.bind("mouse-right","mouse-3"),r.bind("mouse-middle","mouse-2"),r._lastTick=p(),r.startTime=p(),r.paused=!1,r.emit("init")})},0),r}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var u,c=[],l=!1,h=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&p())}function p(){if(!l){var t=a(f);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||l||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){
/*!
  * domready (c) Dustin Diaz 2014 - License MIT
  */
t.exports=function(){var t,e=[],n=document,r=(n.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);return r||n.addEventListener("DOMContentLoaded",t=function(){for(n.removeEventListener("DOMContentLoaded",t),r=1;t=e.shift();)t()}),function(t){r?setTimeout(t,0):e.push(t)}}()},function(t,e){var n,r="undefined"!=typeof window?window.navigator.userAgent:"",i=/OS X/.test(r),o=/Opera/.test(r),s=!/like Gecko/.test(r)&&!o,a=t.exports={0:i?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",27:"<escape>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:i?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num--\x3e",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:i&&s?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:o?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(n=58;n<65;++n)a[n]=String.fromCharCode(n);for(n=48;n<58;++n)a[n]=n-48+"";for(n=65;n<91;++n)a[n]=String.fromCharCode(n);for(n=96;n<106;++n)a[n]="<num-"+(n-96)+">";for(n=112;n<136;++n)a[n]="F"+(n-111)},function(t,e,n){"use strict";t.exports=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}},function(t,e,n){"use strict";t.exports=function(t,e,n){return 0===t.length?t:e?(n||t.sort(e),function(t,e){for(var n=1,r=t.length,i=t[0],o=t[0],s=1;s<r;++s)if(o=i,e(i=t[s],o)){if(s===n){n++;continue}t[n++]=i}return t.length=n,t}(t,e)):(n||t.sort(),function(t){for(var e=1,n=t.length,r=t[0],i=t[0],o=1;o<n;++o,i=r)if(i=r,(r=t[o])!==i){if(o===e){e++;continue}t[e++]=r}return t.length=e,t}(t))}},function(t,e,n){"use strict";function r(t,e,n,r,i,o){var s=["function ",t,"(a,l,h,",r.join(","),"){",o?"":"var i=",n?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",i?".get(m)":"[m]"];return o?e.indexOf("c")<0?s.push(";if(x===y){return m}else if(x<=y){"):s.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):s.push(";if(",e,"){i=m;"),n?s.push("l=m+1}else{h=m-1}"):s.push("h=m-1}else{l=m+1}"),s.push("}"),o?s.push("return -1};"):s.push("return i};"),s.join("")}function i(t,e,n,i){return new Function([r("A","x"+t+"y",e,["y"],!1,i),r("B","x"+t+"y",e,["y"],!0,i),r("P","c(x,y)"+t+"0",e,["y","c"],!1,i),r("Q","c(x,y)"+t+"0",e,["y","c"],!0,i),"function dispatchBsearch",n,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",n].join(""))()}t.exports={ge:i(">=",!1,"GE"),gt:i(">",!1,"GT"),lt:i("<",!0,"LT"),le:i("<=",!0,"LE"),eq:i("-",!0,"EQ",!0)}},function(t,e){for(var n=0,r=["ms","moz","webkit","o"],i=0;i<r.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[r[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[i]+"CancelAnimationFrame"]||window[r[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var r=(new Date).getTime(),i=Math.max(0,16-(r-n)),o=window.setTimeout(function(){t(r+i)},i);return n=r+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})},function(t,e){var n,r,i="";function o(t,e,o,s){t[n](i+e,"wheel"==r?o:function(t){!t&&(t=window.event);var e={originalEvent:t,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"==r?(e.deltaY=-.025*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-.025*t.wheelDeltaX)):e.deltaY=t.detail,o(e)},s||!1)}window.addEventListener?n="addEventListener":(n="attachEvent",i="on"),r="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t.exports=function(t,e,n){o(t,r,e,n),"DOMMouseScroll"==r&&o(t,"MozMousePixelScroll",e,n)}},function(t,e){"object"==typeof window.performance?window.performance.now?t.exports=function(){return window.performance.now()}:window.performance.webkitNow&&(t.exports=function(){return window.performance.webkitNow()}):Date.now?t.exports=Date.now:t.exports=function(){return(new Date).getTime()}},function(t,e,n){"use strict";var r=n(0),i=n(3),o=n(22),s=n(1).removeUnorderedListItem;if(!BABYLON)throw new Error("Babylon.js reference not found! Abort! Abort!");t.exports=function(t,e,n){return new l(t,e,n)};var a=BABYLON.Vector3,u=BABYLON.Color3,c={showFPS:!1,antiAlias:!0,clearColor:[.8,.9,1],ambientColor:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],groundLightColor:[.5,.5,.5],initialCameraZoom:0,cameraZoomSpeed:.2,cameraMaxAngle:Math.PI/2-.01,useAO:!0,AOmultipliers:[.93,.8,.5],reverseAOmultiplier:1,useOctreesForDynamicMeshes:!0,preserveDrawingBuffer:!0};function l(t,e,n){this.noa=t,e=Object.assign({},c,e),this.zoomDistance=e.initialCameraZoom,this._currentZoom=this.zoomDistance,this._cameraZoomSpeed=e.cameraZoomSpeed,this._maxCamAngle=e.cameraMaxAngle,this._dynamicMeshes=[],this.useAO=!!e.useAO,this.aoVals=e.AOmultipliers,this.revAoVal=e.reverseAOmultiplier,this.meshingCutoffTime=6,this._dynamicMeshOctrees=e.useOctreesForDynamicMeshes,function(t,e,n){if(!BABYLON)throw new Error("BABYLON.js engine not found!");t._engine=new BABYLON.Engine(e,n.antiAlias,{preserveDrawingBuffer:n.preserveDrawingBuffer}),t._scene=new BABYLON.Scene(t._engine);var r=t._scene;function i(t){return new u(t[0],t[1],t[2])}r.detachControl(),t._octree=new BABYLON.Octree(t=>{}),t._octree.blocks=[],r._selectionOctree=t._octree,t._rotationHolder=new BABYLON.Mesh("rotHolder",r),t._cameraHolder=new BABYLON.Mesh("camHolder",r),t._camera=new BABYLON.FreeCamera("camera",new a(0,0,0),r),t._camera.parent=t._cameraHolder,t._camera.minZ=.01,t._cameraHolder.visibility=!1,t._rotationHolder.visibility=!1,t._camScreen=BABYLON.Mesh.CreatePlane("camScreen",10,r),t.addMeshToScene(t._camScreen),t._camScreen.position.z=.1,t._camScreen.parent=t._camera,t._camScreenMat=t.makeStandardMaterial("camscreenmat"),t._camScreen.material=t._camScreenMat,t._camScreen.setEnabled(!1),t._camLocBlock=0,t._light=new BABYLON.HemisphericLight("light",new a(.1,1,.3),r),r.clearColor=i(n.clearColor),r.ambientColor=i(n.ambientColor),t._light.diffuse=i(n.lightDiffuse),t._light.specular=i(n.lightSpecular),t._light.groundColor=i(n.groundLightColor),t.flatMaterial=t.makeStandardMaterial("flatmat")}(this,n,e),e.showFPS&&function(){var t=document.createElement("div");t.id="noa_fps";var e="position:absolute; top:0; right:0; z-index:0;";e+="color:white; background-color:rgba(0,0,0,0.5);",e+="font:14px monospace; text-align:center;",e+="min-width:2em; margin:4px;",t.style=e,document.body.appendChild(t);var n=0,r=0,i=performance.now(),o=i;y=function(){n++;var e=performance.now();if(e-o>r&&(r=e-o),o=e,!(e-i<1e3)){var s=Math.round(n/(e-i)*1e3),a=Math.round(1/r*1e3);t.innerHTML=s+"<br>"+a,n=0,r=0,i=e}}}()}l.prototype.initScene=function(){this.cameraTarget=this.noa.ents.createEntity(["position"]),this.noa.ents.addComponent(this.cameraTarget,"followsEntity",{entity:this.noa.playerEntity,offset:[0,this.noa.playerEyeOffset,0]})},l.prototype.getScene=function(){return this._scene},l.prototype.tick=function(t){this._dynamicMeshOctrees&&function(t){for(var e=0;e<t._dynamicMeshes.length;e++){var n=t._dynamicMeshes[e];if(!n._isDisposed){var r=n.position,i=n._currentNoaChunk||null,o=t.noa.world._getChunkByCoords(r.x,r.y,r.z)||null;i!==o&&(i&&i.octreeBlock?s(i.octreeBlock.entries,n):s(t._octree.dynamicContent,n),o&&o.octreeBlock?o.octreeBlock.entries.push(n):t._octree.dynamicContent.push(n),n._currentNoaChunk=o)}}}(this)},l.prototype.render=function(t){g("start"),function(t){t._cameraHolder.rotation.copyFrom(t._rotationHolder.rotation);var e=t.noa.ents.getPositionData(t.cameraTarget).renderPosition;t._cameraHolder.position.copyFromFloats(e[0],e[1],e[2]);var n=t.zoomDistance,s=t._cameraZoomSpeed;n>0&&(n=function(t){p||(p=new i([0,0,0],[.4,.4,.4]),d=function(e,n,r){return t.noa.world.getBlockSolidity(e,n,r)});var e=t._cameraHolder.position;r.set(m,e.x-.2,e.y-.2,e.z-.2),p.setPosition(m);var n=-t.zoomDistance,s=t.getCameraVector();return r.set(v,n*s.x,n*s.y,n*s.z),o(d,p,v,function(t,e,n,r){return!0},!0)}(t))<t._currentZoom&&(t._currentZoom=n);t._currentZoom+=s*(n-t._currentZoom),t._camera.position.z=-t._currentZoom;var a=t.getCameraPosition(),c=t.noa.world.getBlockID(Math.floor(a.x),Math.floor(a.y),Math.floor(a.z));!function(t,e){if(e===t._camLocBlock)return;if(0===e)t._camScreen.setEnabled(!1);else{var n=t.noa.registry.getBlockFaceMaterial(e,0);if(n){var r=t.noa.registry.getMaterialData(n),i=r.color,o=r.alpha;i&&o&&o<1&&(t._camScreenMat.diffuseColor=new u(i[0],i[1],i[2]),t._camScreenMat.alpha=o,t._camScreen.setEnabled(!0))}}t._camLocBlock=e}(t,c)}(this),g("updateCamera"),this._engine.beginFrame(),g("beginFrame"),this._scene.render(),g("render"),y(),this._engine.endFrame(),g("endFrame"),g("end")},l.prototype.resize=function(t){this._engine.resize()},l.prototype.highlightBlockFace=function(t,e,n){var i=function(t){var e=t._highlightMesh;if(!e){var n=BABYLON.Mesh.CreatePlane("highlight",1,t._scene),r=t.makeStandardMaterial("highlightMat");r.backFaceCulling=!1,r.emissiveColor=new u(1,1,1),r.alpha=.2,n.material=r,e=t._highlightMesh=n;var i=.5,o=BABYLON.Mesh.CreateLines("hightlightLines",[new a(i,i,0),new a(i,-i,0),new a(-i,-i,0),new a(-i,i,0),new a(i,i,0)],t._scene);o.color=new u(1,1,1),o.parent=n,t.addMeshToScene(e),t.addMeshToScene(o)}return e}(this);if(t){for(var o=.001+.001*(this._currentZoom+r.distance(this.noa.getPlayerEyePosition(),e)),s=h,c=0;c<3;++c)s[c]=Math.floor(e[c])+.5+(.5+o)*n[c];i.position.copyFromFloats(s[0],s[1],s[2]),i.rotation.x=n[1]?Math.PI/2:0,i.rotation.y=n[0]?Math.PI/2:0}i.setEnabled(t)};var h=r.create();l.prototype.getCameraVector=function(){return a.TransformCoordinates(BABYLON.Axis.Z,this._rotationHolder.getWorldMatrix())};var f=a.Zero();l.prototype.getCameraPosition=function(){return a.TransformCoordinates(f,this._camera.getWorldMatrix())},l.prototype.getCameraRotation=function(){var t=this._rotationHolder.rotation;return[t.x,t.y]},l.prototype.setCameraRotation=function(t,e){var n=this._rotationHolder.rotation;n.x=Math.max(-this._maxCamAngle,Math.min(this._maxCamAngle,t)),n.y=e},l.prototype.addMeshToScene=function(t,e){if(!t._currentNoaChunk&&!this._octree.dynamicContent.includes(t)){var n=t.position,r=this.noa.world._getChunkByCoords(n.x,n.y,n.z);this._dynamicMeshOctrees&&r&&r.octreeBlock?(r.octreeBlock.entries.push(t),t._currentNoaChunk=r):this._octree.dynamicContent.push(t),e||this._dynamicMeshes.push(t);var i=this.removeMeshFromScene.bind(this,t);t.onDisposeObservable.add(i)}},l.prototype.removeMeshFromScene=function(t){t._currentNoaChunk&&t._currentNoaChunk.octreeBlock&&s(t._currentNoaChunk.octreeBlock.entries,t),t._currentNoaChunk=null,s(this._octree.dynamicContent,t),s(this._dynamicMeshes,t)},l.prototype.makeMeshInstance=function(t,e){var n=t.createInstance(t.name+" instance"||!1);return t.billboardMode&&(n.billboardMode=t.billboardMode),this.addMeshToScene(n,e),n._currentLOD=t,n},l.prototype.makeStandardMaterial=function(t){var e=new BABYLON.StandardMaterial(t,this._scene);return e.specularColor.copyFromFloats(0,0,0),e.ambientColor.copyFromFloats(1,1,1),e.diffuseColor.copyFromFloats(1,1,1),e},l.prototype.prepareChunkForRendering=function(t){var e=t.size,n=new a(t.x,t.y,t.z),r=new a(t.x+e,t.y+e,t.z+e);t.octreeBlock=new BABYLON.OctreeBlock(n,r,void 0,void 0,void 0,t=>{}),this._octree.blocks.push(t.octreeBlock)},l.prototype.disposeChunkForRendering=function(t){this.removeTerrainMesh(t),s(this._octree.blocks,t.octreeBlock),t.octreeBlock.entries.length=0,t.octreeBlock=null},l.prototype.addTerrainMesh=function(t,e){this.removeTerrainMesh(t),e.getIndices().length&&this.addMeshToScene(e,!0),t._terrainMesh=e},l.prototype.removeTerrainMesh=function(t){t._terrainMesh&&(t._terrainMesh.dispose(),t._terrainMesh=null)};var p,d,m=r.create(),v=r.create();l.prototype.debug_SceneCheck=function(){var t=this._scene.meshes,e=this._octree.dynamicContent,n=[],r=0,i=this._scene.materials,o=[];i.forEach(t=>{t.subMaterials?t.subMaterials.forEach(t=>o.push(t)):o.push(t)}),this._octree.blocks.forEach(function(t){r++,t.entries.forEach(t=>n.push(t))}),t.forEach(function(t){t._isDisposed&&u(t,"disposed mesh in scene"),function(t){return 0===t.getIndices().length}(t)||(c(t,e,n)&&u(t,"non-empty mesh missing from octree"),t.material?(t.material.subMaterials||[t.material]).forEach(function(t){c(t,i)&&u(t,"mesh material not in scene")}):u(t,"non-empty scene mesh with no material"))});var s=[];o.forEach(e=>{var n=!1;t.forEach(t=>{t.material===e&&(n=!0),t.material&&t.material.subMaterials&&t.material.subMaterials.includes(e)&&(n=!0)}),n||s.push(e.name)}),s.length&&console.warn("Materials unused by any mesh: ",s.join(", ")),e.forEach(function(e){c(e,t)&&u(e,"octree/dynamic mesh not in scene")}),n.forEach(function(e){c(e,t)&&u(e,"octree block mesh not in scene")});var a=Math.round(10*n.length/r)/10;function u(t,e){console.warn(t.name+" --- "+e)}function c(t,e,n){return!!t&&(!e.includes(t)&&(!n||!n.includes(t)))}return console.log("meshes - octree:",n.length,"  dynamic:",e.length,"   avg meshes/octreeBlock:",a),"done."},l.prototype.debug_MeshCount=function(){var t={};for(var e in this._scene.meshes.forEach(e=>{var n=e.name||"";n=(n=(n=(n=n.replace(/-\d+.*/,"#")).replace(/\d+.*/,"#")).replace(/(rotHolder|camHolder|camScreen)/,"rendering use")).replace(/atlas sprite .*/,"atlas sprites"),t[n]=t[n]||0,t[n]++}),t)console.log("   "+(t[e]+"       ").substr(0,7)+e)};var g=function(){},y=function(){}},function(t,e,n){"use strict";var r=n(77),i=n(2).EventEmitter,o=n(78);t.exports=function(t,e){return new c(t,e)};var s,a,u={chunkSize:24,chunkAddDistance:3,chunkRemoveDistance:4};function c(t,e){this.noa=t,e=Object.assign({},u,e),this.userData=null,this.playerChunkLoaded=!1,this.Chunk=o,this.chunkSize=e.chunkSize,this.chunkAddDistance=e.chunkAddDistance,this.chunkRemoveDistance=e.chunkRemoveDistance,this.chunkRemoveDistance<this.chunkAddDistance&&(this.chunkRemoveDistance=this.chunkAddDistance),this._chunkIDsToAdd=[],this._chunkIDsToRemove=[],this._chunkIDsInMemory=[],this._chunkIDsToCreate=[],this._chunkIDsToMesh=[],this._chunkIDsToMeshFirst=[],this._maxChunksPendingCreation=20,this._maxChunksPendingMeshing=20,this._maxProcessingPerTick=9,this._maxProcessingPerRender=5;var n=this;t.on("beforeRender",function(){!function(t){var e=performance.now()+t._maxProcessingPerRender,n=!1;for(;!n&&performance.now()<e;)(n=v(t,!0))||0}(n)}),this._chunkHash=r([1024,1024,1024]);var i=this.chunkSize;if(i&i-1==0){var c=0|Math.log2(i),l=i-1|0;s=(t=>t>>c|0),a=(t=>t&l|0)}else s=(t=>0|Math.floor(t/i)),a=(t=>(t%i+i)%i|0)}function l(t,e,n,r){var i=0,o=0,s=0;for(var a of n)if(a.size)a.isInvalid&&i++;else{var u=f(a),c=p(t,u[0],u[1],u[2]);c.isInvalid&&i++,c.isFull&&o++,c.isEmpty&&s++}var l=(n.length+"        ").substr(0,6),h=r?[", ",o," full, ",s," empty"].join(""):"";console.log(e,l,i,"invalid"+h)}function h(t,e,n){return t+"|"+e+"|"+n}function f(t){var e=t.split("|");return[parseInt(e[0]),parseInt(e[1]),parseInt(e[2])]}function p(t,e,n,r){var i=1023&(0|e),o=1023&(0|n),s=1023&(0|r);return t._chunkHash.get(i,o,s)}function d(t,e,n,r,i){var o=1023&(0|e),s=1023&(0|n),a=1023&(0|r);t._chunkHash.set(o,s,a,i)}function m(t){var e=!0;if(t._chunkIDsToRemove.length){var n=f(t._chunkIDsToRemove.pop());!function(t,e,n,r){var i=p(t,e,n,r);t.emit("chunkBeingRemoved",i.id,i.array,i.userData),t.noa.rendering.disposeChunkForRendering(i),i.dispose(),d(t,e,n,r,0),w(i.id,t._chunkIDsInMemory),w(i.id,t._chunkIDsToMesh),w(i.id,t._chunkIDsToMeshFirst),i.isInvalid&&(t._lastPlayerChunkID="")}(t,n[0],n[1],n[2]),b(t,"removed"),k("removed"),e=!1}if(t._chunkIDsToCreate.length>=t._maxChunksPendingCreation)return e;if(t._chunkIDsToMesh.length>=t._maxChunksPendingMeshing)return e;t._chunkIDsToAdd.length&&(!function(t,e){var n=f(e),r=n[0],i=n[1],s=n[2],a=t.chunkSize,u=new o(t.noa,e,r,i,s,a);d(t,r,i,s,u);var c=r*a-1,l=i*a-1,h=s*a-1;_(e,t._chunkIDsToCreate),t.emit("worldDataNeeded",e,u.array,c,l,h)}(t,t._chunkIDsToAdd.shift()),k("requested"),b(t,"requested"),e=!1);return e}function v(t,e){var n;if(t._chunkIDsToMeshFirst.length)n=t._chunkIDsToMeshFirst.pop();else{if(e||!t._chunkIDsToMesh.length)return!0;n=t._chunkIDsToMesh.pop()}var r=f(n),i=p(t,r[0],r[1],r[2]);if(!i.isInvalid)return i.updateMeshes(),b(t,"meshed"),k("meshed"),!1}function g(t,e,n,r,i,o,s,a){var u=p(t,e,n,r);u&&(u.set(i,o,s,a),_(u.id,t._chunkIDsToMeshFirst),t.emit("chunkChanged",u))}function y(t,e){var n=Object.keys(e);return n.sort((t,n)=>e[t]-e[n]),n.map(e=>t[e])}function _(t,e){e.indexOf(t)>=0||e.push(t)}function w(t,e){var n=e.indexOf(t);n>=0&&e.splice(n,1)}c.prototype=Object.create(i.prototype),c.prototype.getBlockID=function(t,e,n){var r=this._getChunkByCoords(t,e,n);if(!r)return 0;var i=a(t),o=a(e),s=a(n);return r.get(i,o,s)},c.prototype.getBlockSolidity=function(t,e,n){var r=this._getChunkByCoords(t,e,n);if(!r)return 0;var i=a(t),o=a(e),s=a(n);return!!r.getSolidityAt(i,o,s)},c.prototype.getBlockOpacity=function(t,e,n){var r=this.getBlockID(t,e,n);return this.noa.registry.getBlockOpacity(r)},c.prototype.getBlockFluidity=function(t,e,n){var r=this.getBlockID(t,e,n);return this.noa.registry.getBlockFluidity(r)},c.prototype.getBlockProperties=function(t,e,n){var r=this.getBlockID(t,e,n);return this.noa.registry.getBlockProps(r)},c.prototype.getBlockObjectMesh=function(t,e,n){var r=this._getChunkByCoords(t,e,n);if(!r)return 0;var i=a(t),o=a(e),s=a(n);return r.getObjectMeshAt(i,o,s)},c.prototype.setBlockID=function(t,e,n,r){var i=s(e),o=s(n),u=s(r),c=a(e),l=a(n),h=a(r);!function(t,e,n,r,i,o,s,a,u){var c=[0],l=[0],h=[0];0===o?c.push(-1):o===i-1&&c.push(1);0===s?l.push(-1):s===i-1&&l.push(1);0===a?h.push(-1):a===i-1&&h.push(1);for(var f of c){var p=[i,o,-1][f+1];for(var d of l){var m=[i,s,-1][d+1];for(var v of h){var y=[i,a,-1][v+1];g(t,e+f,n+d,r+v,p,m,y,u)}}}}(this,i,o,u,this.chunkSize,c,l,h,t)},c.prototype.isBoxUnobstructed=function(t){for(var e=t.base,n=t.max,r=Math.floor(e[0]);r<n[0]+1;r++)for(var i=Math.floor(e[1]);i<n[1]+1;i++)for(var o=Math.floor(e[2]);o<n[2]+1;o++)if(this.getBlockSolidity(r,i,o))return!1;return!0},c.prototype.tick=function(){k("start");var t=function(t){var e=t.noa.getPlayerPosition(),n=s(e[0]),r=s(e[1]),i=s(e[2]);return[n,r,i]}(this),e=h(t[0],t[1],t[2]);e!=this._lastPlayerChunkID&&(this.emit("playerEnteredChunk",t[0],t[1],t[2]),function(t,e,n,r){for(var i=Math.ceil(t.chunkAddDistance),o=t._chunkIDsToCreate,s=[],a=[],u=t.chunkAddDistance*t.chunkAddDistance,c=e-i;c<=e+i;++c)for(var l=n-i;l<=n+i;++l)for(var f=r-i;f<=r+i;++f){var d=c-e,m=l-n,v=f-r,g=d*d+m*m+v*v;if(!(g>u)&&!p(t,c,l,f)){var _=h(c,l,f);o.indexOf(_)>-1||(s.push(_),a.push(g))}}t._chunkIDsToAdd=y(s,a)}(this,t[0],t[1],t[2]),function(t,e,n,r){for(var i=t.chunkRemoveDistance*t.chunkRemoveDistance,o=t._chunkIDsInMemory,s=[],a=[],u=0;u<o.length;u++){var c=o[u],l=f(c),h=l[0]-e,d=l[1]-n,m=l[2]-r,v=h*h+d*d+m*m;if(v<i){var g=p(t,l[0],l[1],l[2]);if(!g.isInvalid)continue;v*=-1}s.push(c),a.push(v)}t._chunkIDsToRemove=y(s,a)}(this,t[0],t[1],t[2])),this._lastPlayerChunkID=e,k("build queues"),b(this,"start");for(var n=performance.now()+this._maxProcessingPerTick,r=!1;!r&&performance.now()<n;)r=v(this,!1),r&=m(this);b(this,"end");var i=p(this,t[0],t[1],t[2]),o=!(!i||!i.isGenerated||i.isInvalid);this.playerChunkLoaded=o,k("end")},c.prototype.setChunkData=function(t,e,n){b(this,"received");var r=f(t),i=p(this,r[0],r[1],r[2]);i&&!i.isInvalid&&(i.array=e,n&&(i.userData=n),i.initData(),_(t,this._chunkIDsInMemory),w(t,this._chunkIDsToCreate),this.noa.rendering.prepareChunkForRendering(i),_(t,this._chunkIDsToMesh),this.emit("chunkAdded",i))},c.prototype.invalidateAllChunks=function(){var t=this._chunkIDsInMemory.concat(this._chunkIDsToCreate);for(var e of t){var n=f(e);p(this,n[0],n[1],n[2]).isInvalid=!0}this._lastPlayerChunkID=""},c.prototype.report=function(){console.log("World report - playerChunkLoaded: ",this.playerChunkLoaded),l(this,"  to add     ",this._chunkIDsToAdd),l(this,"  to remove: ",this._chunkIDsToRemove),l(this,"  in memory: ",this._chunkIDsInMemory,!0),l(this,"  creating:  ",this._chunkIDsToCreate),l(this,"  meshing:   ",this._chunkIDsToMesh)},c.prototype._getChunkByCoords=function(t,e,n){return p(this,s(t),s(e),s(n))};var b=function(t,e){};var k=function(t){}},function(t,e,n){"use strict";var r=n(4),i=!("undefined"==typeof Map);function o(t){this.length=t,this.store=i?new Map:{}}i?(o.prototype.get=function(t){return this.store.get(t)||0},o.prototype.set=function(t,e){return 0===e?this.store.delete(t):this.store.set(t,e),e}):(o.prototype.get=function(t){return this.store[t]||0},o.prototype.set=function(t,e){return 0===e?delete this.store[t]:this.store[t]=e,e}),t.exports=function(t){for(var e=1,n=0;n<t.length;++n)e*=t[n];return r(new o(e),t)}},function(t,e,n){"use strict";var r=n(23),i=n(4);t.exports=m;var o,s,a,u,c=n(79),l=n(80),h=r.ID_MASK,f=(r.VAR_MASK,r.SOLID_BIT),p=r.OPAQUE_BIT,d=r.OBJECT_BIT;function m(t,e,n,r,c,h){this.id=e,this.noa=t,this.isDisposed=!1,this.isGenerated=!1,this.inInvalid=!1,this.octreeBlock=null,this._terrainMesh=null,this.isEmpty=!1,this.isFull=!1;var f=h+2,p=new Uint16Array(f*f*f);this.array=new i(p,[f,f,f]),this.i=n,this.j=r,this.k=c,this.size=h,this.x=n*h,this.y=r*h,this.z=c*h,this._terrainDirty=!1,this._objectsDirty=!1,function(t){o=t.registry._solidityLookup,s=t.registry._opacityLookup,a=t.registry._blockMeshLookup,u=t.registry._blockHandlerLookup}(t),_(this),l.initChunk(this)}function v(t,e,n,r,i,o){var s=u[e];if(s){var a=s[n];if(a){var c=t.size;r<0||i<0||o<0||r>=c||i>=c||o>=c||a(t.x+r,t.y+i,t.z+o)}}}function g(t){return 0!==t&&(!(t&d)||!!(t&f))}function y(t){var e=t;return o[t]&&(e|=f),s[t]&&(e|=p),a[t]&&(e|=d),e}function _(t){var e=t.array,n=t.size;t._unpaddedView=e.lo(1,1,1).hi(n,n,n)}function w(t,e,n,r,i){l.addObjectBlock(t,e,n,r,i),t._objectsDirty=!0}m.prototype.get=function(t,e,n){return h&this._unpaddedView.get(t,e,n)},m.prototype.getSolidityAt=function(t,e,n){return!!(f&this._unpaddedView.get(t,e,n))},m.prototype.set=function(t,e,n,r){var i=this._unpaddedView.get(t,e,n),o=i&h;if(r!==o){var s=y(r);this._unpaddedView.set(t,e,n,s),i&d&&function(t,e,n,r){l.removeObjectBlock(t,e,n,r),t._objectsDirty=!0}(this,t,e,n),s&d&&w(this,r,t,e,n),0!==s&&(this.isEmpty=!1),s&p||(this.isFull=!1),v(this,o,"onUnset",t,e,n),v(this,r,"onSet",t,e,n),(g(i)||g(s))&&(this._terrainDirty=!0)}},m.prototype.mesh=function(t,e,n,r,i){return c.meshChunk(this,t,e,n,r,i)},m.prototype.updateMeshes=function(){if(this._terrainDirty){this.noa.rendering.removeTerrainMesh(this);var t=this.mesh();t&&this.noa.rendering.addTerrainMesh(this,t),this._terrainDirty=!1}this._objectsDirty&&(l.buildObjectMesh(this),this._objectsDirty=!1)},m.prototype.initData=function(){_(this);for(var t=p,e=!0,n=this.array,r=n.data,i=n.shape[0],o=n.stride[2],s=(this._objectMeshes,0);s<i;++s)for(var a=0===s||s===i-1,u=0;u<i;++u)for(var c=n.index(s,u,0),l=a||0===u||u===i-1,f=0;f<i;++f,c+=o){var m=r[c]&h;if(0!==m){var g=0|y(m);r[c]=g,t&=g,e=!1,l||0===f||f===i-1||(d&g&&w(this,m,s-1,u-1,f-1),v(this,m,"onLoad",s-1,u-1,f-1))}else t=0}this.isFull=!!(t&p),this.isEmpty=!!e,this._terrainDirty=!(this.isFull||this.isEmpty),this.isGenerated=!0},m.prototype.dispose=function(){!function(t,e){for(var n=t._unpaddedView,r=n.data,i=n.stride[0],o=n.stride[1],s=n.stride[2],a=n.shape[0],u=n.offset,c=0;c<a;++c){for(var l=0;l<a;++l){for(var f=0;f<a;++f){var p=h&r[u];v(t,p,e,c,l,f),u+=s}u-=s*a,u+=o}u-=o*a,u+=i}}(this,"onUnload"),l.disposeChunk(this),this.array.data=null,this.array=null,this._unpaddedView=null,this.isGenerated=!1,this.isDisposed=!0}},function(t,e,n){"use strict";t.exports=new function(){var t=new function(){var t=n(23),e=t.ID_MASK,o=(t.VAR_MASK,t.SOLID_BIT),s=t.OPAQUE_BIT,a=t.OBJECT_BIT,u=new Int16Array(16),c=new Uint16Array(16);function l(t,n,r,i,o){for(var s=r.shape[1],a=u,l=c,f=0,p=r.data,d=r.index(t-1,0,0),m=r.stride[0],v=r.stride[1],g=r.stride[2],y=0;y<s;++y){var _=d;d+=g;for(var w=0;w<s;w++,f++,_+=v){var b=p[_],k=p[_+m],M=h(b,k);if(M&&(a[f]=M>0?i(b&e,2*n):-i(k&e,2*n+1),o)){var x=M>0?t:t-1,A=M>0?t-1:t;l[f]=o(r,x,A,w,y)}}}}function h(t,e){if(t===e)return 0;var n=t&s,r=e&s;return n&&r?0:n?1:r?-1:0===e||e&a?1:0===t||t&a?-1:0}function f(t,e,n,i,o,s,a,l,h,f,g){for(var y=0,_=u,w=c,b=a?p:d,k=a?v:m,M=0;M<s;++M)for(var x=1,A=1,E=0;E<o;E+=x,y+=x){var B=0|_[y];if(B){var C=0|w[y];for(x=1;x<o-E&&b(y+x,_,B,w,C);++x);t:for(A=1;A<s-M;++A)for(var D=0;D<x;++D){var P=y+D+A*o;if(!b(P,_,B,w,C))break t}var S=Math.abs(B);l[S]||(l[S]=new r(S));var L=l[S],T=L.colors,I=h(S),O=k(T,I,C,f,g),R=[0,0,0];R[e]=t,R[n]=E,R[i]=M;var j=[0,0,0];j[n]=x;var F=[0,0,0];F[i]=A;var z=L.positions;z.push(R[0],R[1],R[2],R[0]+j[0],R[1]+j[1],R[2]+j[2],R[0]+j[0]+F[0],R[1]+j[1]+F[1],R[2]+j[2]+F[2],R[0]+F[0],R[1]+F[1],R[2]+F[2]);var U=B>0?1:-1;2===e?L.uvs.push(0,A,-U*x,A,-U*x,0,0,0):L.uvs.push(0,x,0,0,U*A,0,U*A,x);var Y=z.length/3-4;B<0?O?L.indices.push(Y,Y+1,Y+2,Y,Y+2,Y+3):L.indices.push(Y+1,Y+2,Y+3,Y,Y+1,Y+3):O?L.indices.push(Y,Y+2,Y+1,Y,Y+3,Y+2):L.indices.push(Y+3,Y+1,Y,Y+3,Y+2,Y+1);var N=0===e?U:0,q=1===e?U:0,H=2===e?U:0;L.normals.push(N,q,H,N,q,H,N,q,H,N,q,H);for(var X=0;X<A;++X)for(var V=0;V<x;++V)_[y+V+X*o]=0}else x=1}}function p(t,e,n,r,i){return n===e[t]&&i===r[t]}function d(t,e,n,r,i){return n===e[t]}function m(t,e,n,r,i){return t.push(e[0],e[1],e[2],1),t.push(e[0],e[1],e[2],1),t.push(e[0],e[1],e[2],1),t.push(e[0],e[1],e[2],1),!0}function v(t,e,n,r,i){var o=_(n,0,0),s=_(n,1,0),a=_(n,1,1),u=_(n,0,1);w(t,e,o,r,i),w(t,e,s,r,i),w(t,e,a,r,i),w(t,e,u,r,i);return o===a?u!==s||2==u:u!==s&&o+a>u+s}function g(t,e,n,r,i){var s=1,a=1,u=1,c=1,l=o,h=l&t.get(e,r,i);return t.get(e,r+1,i)&l&&(++u,++c),t.get(e,r-1,i)&l&&(++s,++a),t.get(e,r,i+1)&l&&(++a,++c),t.get(e,r,i-1)&l&&(++s,++u),h?(c=3==c||t.get(e,r+1,i+1)&l?3:2,a=3==a||t.get(e,r-1,i+1)&l?3:2,u=3==u||t.get(e,r+1,i-1)&l?3:2,s=3==s||t.get(e,r-1,i-1)&l?3:2):(1===c&&t.get(e,r+1,i+1)&l&&(c=2),1===a&&t.get(e,r-1,i+1)&l&&(a=2),1===u&&t.get(e,r+1,i-1)&l&&(u=2),1===s&&t.get(e,r-1,i-1)&l&&(s=2)),c<<6|u<<4|a<<2|s}function y(t,e,n,r,i){var s=1,a=1,u=1,c=1,l=o,h=l&t.get(e,r,i);return t.get(e,r+1,i)&l&&(++u,++c),t.get(e,r-1,i)&l&&(++s,++a),t.get(e,r,i+1)&l&&(++a,++c),t.get(e,r,i-1)&l&&(++s,++u),h?(c=3==c||t.get(e,r+1,i+1)&l?3:2,a=3==a||t.get(e,r-1,i+1)&l?3:2,u=3==u||t.get(e,r+1,i-1)&l?3:2,s=3==s||t.get(e,r-1,i-1)&l?3:2):(1===c&&(t.get(e,r+1,i+1)&l?c=2:t.get(n,r,i+1)&l&&t.get(n,r+1,i)&l&&t.get(n,r+1,i+1)&l||(c=0)),1===u&&(t.get(e,r+1,i-1)&l?u=2:t.get(n,r,i-1)&l&&t.get(n,r+1,i)&l&&t.get(n,r+1,i-1)&l||(u=0)),1===a&&(t.get(e,r-1,i+1)&l?a=2:t.get(n,r,i+1)&l&&t.get(n,r-1,i)&l&&t.get(n,r-1,i+1)&l||(a=0)),1===s&&(t.get(e,r-1,i-1)&l?s=2:t.get(n,r,i-1)&l&&t.get(n,r-1,i)&l&&t.get(n,r-1,i-1)&l||(s=0))),c<<6|u<<4|a<<2|s}function _(t,e,n){var r=e?n?6:4:n?2:0;return t>>r&3}function w(t,e,n,r,i){var o=0===n?i:r[n-1];t.push(e[0]*o,e[1]*o,e[2]*o,1)}this.mesh=function(t,e,n,r,o,s){var a,h=[],p=r&&s===o[0];r&&(a=p?g:y);for(var d=0;d<3;++d){var m=(d+1)%3,v=(d+2)%3,_=t.transpose(d,m,v).lo(1,1,1).hi(t.shape[d]-2,t.shape[m]-2,t.shape[v]-2),w=_.shape[0]-1,b=_.shape[1],k=_.shape[2];u.length<b*k&&(u=new Int16Array(b*k),c=new Uint16Array(b*k));for(var M=0;M<=w;++M)l(M,d,_,e,a),i("built masks"),f(M,d,m,v,b,k,r,h,n,o,s),i("build submeshes")}return h}},e=new function(){var t;function e(t,e){for(var n,r=[],i=[],o=[],s=Object.keys(t),a=null,u=0;u<s.length;++u){var c=t[s[u]];if(e(c))if(r.push(c.positions.length),i.push(c.indices.length),o.push(c.id),a){var l=a.positions.length/3;a.positions=a.positions.concat(c.positions),a.normals=a.normals.concat(c.normals),a.colors=a.colors.concat(c.colors),a.uvs=a.uvs.concat(c.uvs);for(var h=0,f=c.indices.length;h<f;++h)a.indices.push(c.indices[h]+l);c.dispose(),delete t[s[u]]}else a=c,n=s[u]}return{mergedID:n,vertices:r,indices:i,matIDs:o}}function n(e,n,r,i,o){var s=t.rendering.getScene(),a=new BABYLON.Mesh(n,s),u=new BABYLON.VertexData;if(u.positions=e.positions,u.indices=e.indices,u.normals=e.normals,u.colors=e.colors,u.uvs=e.uvs,u.applyToMesh(a),e.dispose(),1===r.length)a.material=r[0];else{var c=new BABYLON.MultiMaterial("multimat "+n,s);a.subMeshes=[];u.positions.length,u.indices.length;for(var l=0,h=0,f=0;f<r.length;f++){c.subMaterials[f]=r[f];var p=new BABYLON.SubMesh(f,l,i[f],h,o[f],a);a.subMeshes[f]=p,l+=i[f],h+=o[f]}a.material=c}return a}this.build=function(r,o,s){t=r.noa;e(o,function(e){if(s)return!0;if(e.renderMat)return!1;var n=t.registry.getMaterialTexture(e.id),r=t.registry.getMaterialData(e.id).alpha;if(n||r<1)return!1});var a=e(o,()=>!0),u=o[a.mergedID],c="chunk_"+r.id,l=a.matIDs.map(t=>i(t,s)),h=n(u,c,l,a.vertices,a.indices),f=r.i*r.size,p=r.j*r.size,d=r.k*r.size;return h.position.x=f,h.position.y=p,h.position.z=d,h.freezeWorldMatrix(),h.freezeNormals(),h},this.buildWithoutMultimats=function(r,o,s){t=r.noa;e(o,function(e){if(s)return!0;if(e.renderMat)return!1;var n=t.registry.getMaterialTexture(e.id),r=t.registry.getMaterialData(e.id).alpha;if(n||r<1)return!1});for(var a=null,u=Object.keys(o),c=0;c<u.length;++c){var l=o[u[c]],h=l.id,f=i(h,s),p="chunk_inner_"+r.id+" "+h,d=n(l,p,[f]);if(a)d.parent=a;else{a=d;var m=r.i*r.size,v=r.j*r.size,g=r.k*r.size;a.position.x=m,a.position.y=v,a.position.z=g}d.freezeWorldMatrix(),d.freezeNormals()}return a};var r={};function i(e,n){if(n)return t.rendering.flatMaterial;var i="terrain mat "+e;return r[i]||(r[i]=function(e){var n=t.registry.getMaterialData(e);if(n.renderMat)return n.renderMat;var r=t.registry.getMaterialTexture(e),i=n.alpha;if(!r&&1==i)return t.rendering.flatMaterial;var o=t.rendering.flatMaterial.clone("terrain"+e);if(r){var s=t.rendering.getScene(),a=new BABYLON.Texture(r,s,!0,!1,BABYLON.Texture.NEAREST_SAMPLINGMODE);n.textureAlpha&&(a.hasAlpha=!0),o.diffuseTexture=a}n.alpha<1&&(o.alpha=n.alpha);return o}(e)),r[i]}};this.meshChunk=function(n,r,o,s,a,u,c){i("start");var l,h=n.noa,f=n.array,p=r||h.registry.getBlockFaceMaterial,d=o||h.registry._getMaterialVertexColor,m=void 0===a?h.rendering.useAO:a,v=u||h.rendering.aoVals,g=isNaN(c)?h.rendering.revAoVal:c,y=t.mesh(f,p,d,m,v,g);return y.length&&(l=e.build(n,y,s),i("built terrain")),i("end"),l||null}};function r(t){this.id=0|t,this.positions=[],this.indices=[],this.normals=[],this.colors=[],this.uvs=[]}r.prototype.dispose=function(){this.positions=null,this.indices=null,this.normals=null,this.colors=null,this.uvs=null};var i=function(){}},function(t,e,n){"use strict";var r=n(1).removeUnorderedListItem;t.exports=new function(){function t(t){for(var e=t._mergedObjectSystems;e.length;){var n=e.pop();n.mesh&&t.octreeBlock&&t.octreeBlock.entries&&r(t.octreeBlock.entries,n.mesh),n.mesh&&n.mesh.dispose(),n.dispose()}}function e(t,e,n,r,i,o){var s=t._objectBlocks,a=new BABYLON.SolidParticleSystem("object_sps_"+t.id,e,{updatable:!1}),u=t.noa.registry._blockHandlerLookup,c=t.noa.registry._blockMeshLookup;for(var l in n){var h,f=c[l],p=n[l],d=p.length,m=u[l];m&&(h=m.onCustomMeshCreate);a.addShape(f,d,{positionFunction:function(t,e,n){var a=p[n],u=s[a];t.position.set(r+u.x+.5,i+u.y,o+u.z+.5),h&&h(t,r+u.x,i+u.y,o+u.z);t.position.x-=r,t.position.y-=i,t.position.z-=o}}),p.length=0}return a}this.initChunk=function(t){t._objectBlocks={},t._mergedObjectSystems=[]},this.disposeChunk=function(e){t(e),e._objectBlocks=null},this.addObjectBlock=function(t,e,n,r,i){var o=n+"|"+r+"|"+i;t._objectBlocks[o]=new function(t,e,n,r){this.id=0|t,this.x=0|e,this.y=0|n,this.z=0|r}(e,n,r,i,null)},this.removeObjectBlock=function(t,e,n,r){var i=e+"|"+n+"|"+r;t._objectBlocks[i]&&delete t._objectBlocks[i]},this.buildObjectMesh=function(n){i("start"),t(n);var r=n.noa.rendering.getScene(),o=n.noa.registry._blockMeshLookup,s={};for(var a in n._objectBlocks){var u=n._objectBlocks[a],c=u.id,l=o[c].material,h=l?r.materials.indexOf(l):-1;s[h]||(s[h]={}),s[h][c]||(s[h][c]=[]),s[h][c].push(a)}i("preprocess");var f=n.i*n.size,p=n.j*n.size,d=n.k*n.size;for(var m in s){var v=s[m],g=e(n,r,v,f,p,d);i("made SPS");var y=g.buildMesh();i("built mesh"),y.material=m>-1?r.materials[m]:null,y.position.x=f,y.position.y=p,y.position.z=d,y.freezeWorldMatrix(),y.freezeNormals(),n.octreeBlock.entries.push(y),n._mergedObjectSystems.push(g)}i("end")}};var i=function(){}},function(t,e,n){"use strict";var r=n(82);t.exports=function(t,e,n){return function(t,e,n){e=Object.assign({},i,e);var o=r(n,e),s=e.bindings;for(var a in s){var u=Array.isArray(s[a])?s[a]:[s[a]];u.unshift(a),o.bind.apply(o,u)}return o}(0,e,n)};var i={bindings:{forward:["W","<up>"],left:["A","<left>"],backward:["S","<down>"],right:["D","<right>"],fire:"<mouse 1>","mid-fire":["<mouse 2>","Q"],"alt-fire":["<mouse 3>","E"],jump:"<space>",sprint:"<shift>",crouch:"<control>"}}},function(t,e,n){"use strict";var r=n(83),i=n(2).EventEmitter,o=n(84);function s(t,e){this.element=t||document,e=e||{},this.preventDefaults=!!e.preventDefaults,this.stopPropagation=!!e.stopPropagation,this.down=new i,this.up=new i,this.state={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this._keybindmap={},this._keyStates={},this._bindPressCounts={},this.initEvents()}function a(t,e,n){p(n.keyCode,r[n.keyCode],e,t,n)}function u(t,e,n){return p(-1-n.button,"<mouse "+(n.button+1)+">",e,t,n),!1}function c(t,e){var n=e.movementX||e.mozMovementX||0,r=e.movementY||e.mozMovementY||0;if(e.touches&&0==(n|r)){var i=function(t){for(var e,n=t.changedTouches,r=0;r<n.length;++r)n[r].identifier==f&&(e=n[r]);if(!e)return[0,0];var i=[e.clientX-l,e.clientY-h];return l=e.clientX,h=e.clientY,i}(e);n=i[0],r=i[1]}t.state.dx+=n,t.state.dy+=r}t.exports=function(t,e){return new s(t,e)},s.prototype.initEvents=function(){window.addEventListener("keydown",a.bind(void 0,this,!0),!1),window.addEventListener("keyup",a.bind(void 0,this,!1),!1),this.element.addEventListener("mousedown",u.bind(void 0,this,!0),!1),this.element.addEventListener("mouseup",u.bind(void 0,this,!1),!1),this.element.oncontextmenu=function(t){if(t._keybindmap["<mouse 3>"])return!1}.bind(void 0,this),this.element.addEventListener("dragstart",u.bind(void 0,this,!1),!1),this.element.addEventListener("mousemove",c.bind(void 0,this),!1),this.element.addEventListener("touchmove",c.bind(void 0,this),!1),this.element.addEventListener("touchstart",function(t,e){var n=e.changedTouches[0];l=n.clientX,h=n.clientY,f=n.identifier}.bind(void 0,this),!1),o(this.element,function(t,e){var n=1;switch(e.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=t.element.clientHeight||window.innerHeight}return t.state.scrollx+=e.deltaX*n,t.state.scrolly+=e.deltaY*n,t.state.scrollz+=e.deltaZ*n||0,!1}.bind(void 0,this),!1)},s.prototype.bind=function(t){for(var e=1;e<arguments.length;++e){var n=arguments[e],r=this._keybindmap[n]||[];-1==r.indexOf(t)&&r.push(t),this._keybindmap[n]=r}this.state[t]=!!this.state[t]},s.prototype.unbind=function(t){for(var e in this._keybindmap){var n=this._keybindmap[e],r=n.indexOf(t);r>-1&&n.splice(r,1)}},s.prototype.tick=function(){this.state.dx=this.state.dy=0,this.state.scrollx=this.state.scrolly=this.state.scrollz=0},s.prototype.getBoundKeys=function(){var t=[];for(var e in this._keybindmap)t.push(e);return t};var l=0,h=0,f=null;function p(t,e,n,r,i){var o=r._keybindmap[e];if(o){if(r.preventDefaults&&i.preventDefault(),r.stopPropagation&&i.stopPropagation(),m(r._keyStates[t],n))for(var s=0;s<o.length;++s)d(o[s],n,r,i);r._keyStates[t]=n}}function d(t,e,n,r){var i=n._bindPressCounts[t]||0;((i+=e?1:-1)<0&&(i=0),n._bindPressCounts[t]=i,m(n.state[t],i))&&(e?n.down:n.up).emit(t,r);n.state[t]=!!i}function m(t,e){return t?!e:e}},function(t,e,n){"use strict";var r,i="undefined"!=typeof window?window.navigator.userAgent:"",o=/OS X/.test(i),s=/Opera/.test(i),a=!/like Gecko/.test(i)&&!s,u=t.exports={0:o?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:o?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num--\x3e",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:o&&a?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:s?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(r=58;r<65;++r)u[r]=String.fromCharCode(r);for(r=48;r<58;++r)u[r]=r-48+"";for(r=65;r<91;++r)u[r]=String.fromCharCode(r);for(r=96;r<106;++r)u[r]="<num-"+(r-96)+">";for(r=112;r<136;++r)u[r]="F"+(r-111)},function(t,e){var n,r,i="";function o(t,e,o,s){t[n](i+e,"wheel"==r?o:function(t){!t&&(t=window.event);var e={originalEvent:t,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"==r?(e.deltaY=-.025*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-.025*t.wheelDeltaX)):e.deltaY=t.detail,o(e)},s||!1)}window.addEventListener?n="addEventListener":(n="attachEvent",i="on"),r="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t.exports=function(t,e,n){o(t,r,e,n),"DOMMouseScroll"==r&&o(t,"MozMousePixelScroll",e,n)}},function(t,e,n){"use strict";var r=n(86);t.exports=function(t,e){return function(t,e){e=Object.assign({},i,e);var n=t.world;return r(e,function(t,e,r){return n.getBlockSolidity(t,e,r)},function(t,e,r){return n.getBlockFluidity(t,e,r)})}(t,e)};var i={gravity:[0,-10,0],airDrag:.1}},function(t,e,n){"use strict";var r=n(3),i=n(0),o=n(22),s=n(87);t.exports=function(t,e,n){return new u(t,e,n)};var a={gravity:[0,-10,0],minBounceImpulse:.5,airDrag:.1,fluidDrag:.4,fluidDensity:2};function u(t,e,n){t=Object.assign({},a,t),this.gravity=t.gravity,this.airDrag=t.airDrag,this.fluidDensity=t.fluidDensity,this.fluidDrag=t.fluidDrag,this.minBounceImpulse=t.minBounceImpulse,this.bodies=[],this.testSolid=e,this.testFluid=n}u.prototype.addBody=function(t,e,n,i,o,a){t=t||new r([0,0,0],[1,1,1]),void 0===e&&(e=1),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=1);var u=new s(t,e,n,i,o,a);return this.bodies.push(u),u},u.prototype.removeBody=function(t){var e=this.bodies.indexOf(t);e<0||(this.bodies.splice(e,1),t.aabb=t.onCollide=null)};var c=i.create(),l=i.create(),h=i.create(),f=i.create(),p=i.create();u.prototype.tick=function(t){t/=1e3;var e=x(0,i.squaredLength(this.gravity));this.bodies.forEach(n=>(function(t,e,n,r){if(i.copy(p,e.resting),e.mass<=0)return i.set(e.velocity,0,0,0),i.set(e._forces,0,0,0),void i.set(e._impulses,0,0,0);var s=r||0===e.gravityMultiplier;if(function(t,e,n,r){if(e._sleepFrameCount>0)return!1;if(r)return!0;var s=!1,a=.5*n*n*e.gravityMultiplier;return i.scale(M,t.gravity,a),o(t.testSolid,e.aabb,M,function(){return s=!0,!0},!0),s}(t,e,n,s))return;e._sleepFrameCount--,function(t,e){var n=e.aabb,r=Math.floor(n.base[0]),o=Math.floor(n.base[2]),s=Math.floor(n.base[1]),a=Math.floor(n.max[1]);if(!t.testFluid(r,s,o))return e.inFluid=!1,void(e.ratioInFluid=0);for(var u=1,c=s+1;c<=a&&t.testFluid(r,c,o);)u++,c++;var l=(s+u-n.base[1])/n.vec[1];l>1&&(l=1);var h=n.vec[0]*n.vec[1]*n.vec[2]*l,f=d;i.scale(f,t.gravity,-t.fluidDensity*h),e.applyForce(f),e.inFluid=!0,e.ratioInFluid=l}(t,e),E(e._forces),E(e._impulses),E(e.velocity),E(e.resting),i.scale(c,e._forces,1/e.mass),i.scaleAndAdd(c,c,t.gravity,e.gravityMultiplier),i.scale(l,e._impulses,1/e.mass),i.scaleAndAdd(l,l,c,n),i.add(e.velocity,e.velocity,l),e.friction&&(m(0,e,l),m(1,e,l),m(2,e,l));var a=e.airDrag>=0?e.airDrag:t.airDrag;e.inFluid&&(a=e.fluidDrag>=0?e.fluidDrag:t.fluidDrag,a*=1-(1-e.ratioInFluid)**2);var u=Math.max(1-a*n/e.mass,0);i.scale(e.velocity,e.velocity,u),i.scale(h,e.velocity,n),i.set(e._forces,0,0,0),i.set(e._impulses,0,0,0),e.autoStep&&A(y,e.aabb);g(t,e.aabb,h,e.resting),e.autoStep&&function(t,e,n,r){if(e.resting[1]>=0&&!e.inFluid)return;var s=0!==e.resting[0],a=0!==e.resting[2];if(!s&&!a)return;var u=Math.abs(r[0]/r[2]);if(!s&&u>4)return;if(!a&&u<.25)return;i.add(w,n.base,r);var c=t.testSolid;o(c,n,r,function(t,e,n,r){if(1!==e)return!0;r[e]=0});var l=e.aabb.base[1],h=Math.floor(l+1.001)-l;i.set(b,0,h,0);var f=!1;if(o(c,n,b,function(t,e,n,r){return f=!0,!0}),f)return;if(i.subtract(k,w,n.base),k[1]=0,g(t,n,k,_),s&&!x(n.base[0],w[0]))return;if(a&&!x(n.base[2],w[2]))return;A(e.aabb,n),e.resting[0]=_[0],e.resting[2]=_[2],e.onStep&&e.onStep()}(t,e,y,h);for(var v=0;v<3;++v)f[v]=0,e.resting[v]&&(p[v]||(f[v]=-e.velocity[v]),e.velocity[v]=0);var B=i.length(f);B>.001&&(B>t.minBounceImpulse&&e.restitution&&(i.scale(f,f,e.restitution*e.mass),e.applyImpulse(f)),e.onCollide&&e.onCollide(f));i.squaredLength(e.velocity)>1e-5&&e._markActive()})(this,n,t,e))};var d=i.create();function m(t,e,n){var r=e.resting[t],o=n[t];if(0!==r&&!(r*o<=0)){i.copy(v,e.velocity),v[t]=0;var s=i.length(v);if(!x(s,0)){var a=Math.abs(e.friction*o),u=s>a?(s-a)/s:0;e.velocity[(t+1)%3]*=u,e.velocity[(t+2)%3]*=u}}}var v=i.create();function g(t,e,n,r){return i.set(r,0,0,0),o(t.testSolid,e,n,function(t,e,n,i){r[e]=n,i[e]=0})}var y=new r([],[]),_=i.create(),w=i.create(),b=i.create(),k=i.create();var M=i.create();function x(t,e){return Math.abs(t-e)<1e-5}function A(t,e){for(var n=0;n<3;n++)t.base[n]=e.base[n],t.max[n]=e.max[n],t.vec[n]=e.vec[n]}var E=function(){}},function(t,e,n){"use strict";var r=n(3),i=n(0);function o(t,e,n,o,s,a,u){this.aabb=new r(t.base,t.vec),this.mass=e,this.friction=n,this.restitution=o,this.gravityMultiplier=s,this.onCollide=a,this.autoStep=!!u,this.airDrag=-1,this.fluidDrag=-1,this.onStep=null,this.velocity=i.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=i.create(),this._impulses=i.create(),this._sleepFrameCount=10}t.exports=o,o.prototype.setPosition=function(t){s(t),i.subtract(t,t,this.aabb.base),this.aabb.translate(t),this._markActive()},o.prototype.getPosition=function(){return i.clone(this.aabb.base)},o.prototype.applyForce=function(t){s(t),i.add(this._forces,this._forces,t),this._markActive()},o.prototype.applyImpulse=function(t){s(t),i.add(this._impulses,this._impulses,t),this._markActive()},o.prototype._markActive=function(){this._sleepFrameCount=10},o.prototype.atRestX=function(){return this.resting[0]},o.prototype.atRestY=function(){return this.resting[1]},o.prototype.atRestZ=function(){return this.resting[2]};var s=function(){}},function(t,e,n){"use strict";t.exports=function(t,e){return new i(t,e)};var r={rotationScaleX:.0025,rotationScaleY:.0025,inverseY:!1};function i(t,e){this.noa=t,e=Object.assign({},r,e),this.rotationScaleX=e.rotationScaleX,this.rotationScaleY=e.rotationScaleY,this.inverseY=e.inverseY}i.prototype.updateForRender=function(){var t=this.noa.inputs.state;!function(t){var e=t.dx,n=t.dy,r=document.body.clientWidth/6,i=document.body.clientHeight/6,o=Math.abs(e)>r&&e/s<-1,u=Math.abs(n)>i&&n/a<-1;o||u?(t.dx=s,t.dy=a,s=e>0?1:-1,a=n>0?1:-1):(e&&(s=e),n&&(a=n))}(t);var e=this.rotationScaleY*t.dy*(this.inverseY?-1:1),n=this.rotationScaleX*t.dx,r=this.noa.rendering.getCameraRotation(),i=function(t,e){return isFinite(e)?Math.max(Math.min(t,e),-e):t}(r[0]+e,o),u=(r[1]+n)%(2*Math.PI);this.noa.rendering.setCameraRotation(i,u)};var o=Math.PI/2-1e-4;var s=0,a=0},function(t,e,n){"use strict";t.exports=function(t,e){return new function(t,e){this.noa=t;var n=[!1],a=[!1],u=[!1],c=[null,null,null,null,null,null],l=[null],h=[null],f=[null],p={},d=[null],m=(e=Object.assign({},r,e)).texturePath;this.registerBlock=function(t,e){e=e||{},i.solid=!e.fluid,i.opaque=!e.fluid;var r=Object.assign({},i,e);if(t<1||t>o)throw"Block id exceeds max: "+t;for(;t>n.length;)this.registerBlock(n.length,{});n[t]=!!r.solid,a[t]=!!r.opaque,u[t]=!!r.fluid,h[t]=r.blockMesh||null,h[t]&&(r.material=null);var d,m=r.material||null;if(m)if("string"==typeof m)d=[m,m,m,m,m,m];else if(m.length&&2==m.length)d=[m[1],m[1],m[0],m[0],m[1],m[1]];else if(m.length&&3==m.length)d=[m[2],m[2],m[0],m[1],m[2],m[2]];else{if(!m.length||6!=m.length)throw"Invalid material parameter: "+m;d=m}else d=[null,null,null,null,null,null];for(var v=0;v<6;++v)c[6*t+v]=s(this,p,d[v],!0);l[t]={},u[t]&&(l[t].fluidDensity=r.fluidDensity,l[t].viscosity=r.viscosity);var g=r.onLoad||r.onUnload||r.onSet||r.onUnset||r.onCustomMeshCreate;return f[t]=g?new function(t){this.onLoad=t.onLoad||null,this.onUnload=t.onUnload||null,this.onSet=t.onSet||null,this.onUnset=t.onUnset||null,this.onCustomMeshCreate=t.onCustomMeshCreate||null}(r):null,t},this.registerMaterial=function(t,e,n,r,i){var o=p[t]||d.length;p[t]=o;var s=1;return e&&4==e.length&&(s=e.pop()),d[o]={color:e||[1,1,1],alpha:s,texture:n?m+n:"",textureAlpha:!!r,renderMat:i||null},o},this.getBlockSolidity=function(t){return n[t]},this.getBlockOpacity=function(t){return a[t]},this.getBlockFluidity=function(t){return u[t]},this.getBlockProps=function(t){return l[t]},this.getBlockFaceMaterial=function(t,e){return c[6*t+e]},this.getMaterialColor=function(t){return d[t].color},this.getMaterialTexture=function(t){return d[t].texture},this.getMaterialData=function(t){return d[t]},this._solidityLookup=n,this._opacityLookup=a,this._blockMeshLookup=h,this._blockHandlerLookup=f,this._getMaterialVertexColor=function(t){return d[t].texture?v:d[t].color};var v=[1,1,1];this.registerMaterial("dirt",[.4,.3,0],null),this.registerBlock(1,{material:"dirt"})}(t,e)};var r={texturePath:""},i={solid:!0,opaque:!0,fluidDensity:1,viscosity:.5},o=255;function s(t,e,n,r){if(!n)return null;var i=e[n];return void 0===i&&r&&(i=t.registerMaterial(n)),i}},function(t,e,n){"use strict";var r=n(3),i=n(0),o=n(91);t.exports=function(t,e){return new a(t,e)};var s={shadowDistance:10};function a(t,e){o.call(this),this.noa=t,e=Object.assign({},s,e),this.names={};var r=e.shadowDistance;this.names.position=this.createComponent(n(92)(t)),this.names.physics=this.createComponent(n(93)(t)),this.names.followsEntity=this.createComponent(n(94)(t)),this.names.mesh=this.createComponent(n(95)(t)),this.names.shadow=this.createComponent(n(96)(t,r)),this.names.collideTerrain=this.createComponent(n(97)(t)),this.names.collideEntities=this.createComponent(n(98)(t)),this.names.smoothCamera=this.createComponent(n(109)(t)),this.names.movement=this.createComponent(n(110)(t)),this.names.receivesInputs=this.createComponent(n(111)(t)),this.names.fadeOnZoom=this.createComponent(n(112)(t)),this.isPlayer=function(e){return e===t.playerEntity},this.hasPhysics=this.getComponentAccessor(this.names.physics),this.cameraSmoothed=this.getComponentAccessor(this.names.smoothCamera),this.hasMesh=this.getComponentAccessor(this.names.mesh),this.hasPosition=this.getComponentAccessor(this.names.position);var a=this.getStateAccessor(this.names.position);this.getPositionData=a,this.getPosition=function(t){return a(t).position},this.setPosition=function(t,e,n,r){var o=this.getPositionData(t);i.set(o.position,e,n,r),i.set(o.renderPosition,e,n,r),o._extentsChanged=!0,this.hasPhysics(t)&&c(this.getPhysicsBody(t).aabb,o)};var u=this.getStateAccessor(this.names.physics);this.getPhysicsBody=function(t){return u(t).body},this.getMeshData=this.getStateAccessor(this.names.mesh),this.getMovement=this.getStateAccessor(this.names.movement),this.getCollideTerrain=this.getStateAccessor(this.names.collideTerrain),this.getCollideEntities=this.getStateAccessor(this.names.collideEntities),this.onPairwiseEntityCollision=function(t,e){};var l=this;t.on("tick",function(t){l.tick(t)}),t.on("beforeRender",function(t){l.render(t)})}a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.addComponentAgain=function(t,e,n){this.hasComponent(t,e)&&this.removeComponent(t,e,!0),this.addComponent(t,e,n)},a.prototype.isTerrainBlocked=function(t,e,n){var r=u;return r.setPosition([t+.001,e+.001,n+.001]),this.getEntitiesInAABB(r,this.names.collideTerrain).length>0};var u=new r([0,0,0],[.998,.998,.998]);function c(t,e){var n=e.width,r=e.position,o=n/2;i.set(t.base,r[0]-o,r[1],r[2]-o),i.set(t.vec,n,e.height,n),i.add(t.max,t.base,t.vec)}a.prototype.setEntitySize=function(t,e,n,r){if(!this.hasPosition(t))throw"Set size of entity without a position component";var i=this.getPositionData(t);(i.width=(e+r)/2,i.height=n,i._extentsChanged=!0,this.hasPhysics(t))&&c(this.getPhysicsBody(t).aabb,i)},a.prototype.getEntitiesInAABB=function(t,e){for(var n=[],r=this,i=e?r.getStatesList(e).map(function(t){return r.getPositionData(t.__id)}):i=r.getStatesList(this.names.position),o=l,s=0;s<i.length;s++)c(o,i[s]),t.intersects(o)&&n.push(i[s].__id);return n};var l=new r([],[]);a.prototype.add=function(t,e,n,r,o,s,a){var u=this,c=this.createEntity(),l=i.create();if(i.copy(l,t),this.addComponent(c,this.names.position,{position:l,width:e,height:n}),s){this.addComponent(c,this.names.physics);var h=this.getPhysicsBody(c),f=this.names.smoothCamera;h.onStep=function(){u.addComponentAgain(c,f)}}return r&&(o||(o=i.create()),this.addComponent(c,this.names.mesh,{mesh:r,offset:o})),a&&this.addComponent(c,this.names.shadow,{size:e}),c}},function(t,e,n){"use strict";t.exports=i;var r=n(21)._extend;function i(){this.components={},this.comps=this.components,this._uid=1,this._data={},this._systems=[],this._renderSystems=[],this._deferredEntityRemovals=[],this._deferredCompRemovals=[],this._deferredMultiCompRemovals=[]}function o(t){!function(t){for(;t._deferredEntityRemovals.length;){var e=t._deferredEntityRemovals.pop();u(t,e)}}(t),c(t),function(t){for(;t._deferredMultiCompRemovals.length;){var e=t._deferredMultiCompRemovals.pop();h(t,e.id,e.comp,e.state),e.state=null}}(t)}function s(t){a||(a=!0,setTimeout(function(){o(t),a=!1},0))}var a=!1;function u(t,e){for(var n=Object.keys(t._data),r=0;r<n.length;r++){var i=n[r];t._data[i].hash[e]&&t.removeComponent(e,i,!0)}}function c(t){for(;t._deferredCompRemovals.length;){var e=t._deferredCompRemovals.pop();l(t,e.id,e.comp)}}function l(t,e,n){var r=t.components[n];if(r){var i=t._data[n];if(i&&i.hash[e]){if(r.onRemove)if(r.multi)i.hash[e].forEach(function(t){r.onRemove(e,t)});else r.onRemove(e,i.hash[e]);r.multi&&(i.hash[e].length=0);var o=i.map[e],s=i.list;if(o===s.length-1)s.pop();else{s[o]=s.pop();var a=s[o].__id;i.map[a]=o}delete i.hash[e],delete i.map[e]}}}function h(t,e,n,r){var i=t.components[n];if(i){var o=t._data[n];if(o){var s=o.hash[e];if(s){var a=s.indexOf(r);a<0||(i.onRemove&&i.onRemove&&i.onRemove(e,r),s.splice(a,1),0===s.length&&t.removeComponent(e,n,!0))}}}}i.prototype.createEntity=function(t){var e=this._uid++;if(t&&t.length)for(var n=0;n<t.length;n++)this.addComponent(e,t[n]);return e},i.prototype.deleteEntity=function(t,e){return e?u(this,t):(this._deferredEntityRemovals.push(t),s(this)),this},i.prototype.createComponent=function(t){if(!t)throw"Missing component definition";var e=t.name;if(!e)throw"Component definition must have a name property.";if("string"!=typeof e)throw"Component name must be a string.";if(""===e)throw"Component name must be a non-empty string.";if(this._data[e])throw'Component "'+e+'" already exists.';var n={};return n.name=e,n.state=t.state||{},n.onAdd=t.onAdd||null,n.onRemove=t.onRemove||null,n.system=t.system||null,n.renderSystem=t.renderSystem||null,n.multi=!!t.multi,this.components[e]=n,n.system&&this._systems.push(e),n.renderSystem&&this._renderSystems.push(e),this._data[e]={list:[],hash:{},map:{}},e},i.prototype.deleteComponent=function(t){var e=this._data[t];if(!e)throw"Unknown component: "+t+".";for(var n=e.list;n.length;){var r=n[n.length-1].__id;this.removeComponent(r,t,!0)}var i=this._systems.indexOf(t);return i>-1&&this._systems.splice(i,1),(i=this._renderSystems.indexOf(t))>-1&&this._renderSystems.splice(i,1),delete this.components[t],delete this._data[t],this},i.prototype.addComponent=function(t,e,n){var i=this.components[e],o=this._data[e];if(!o)throw"Unknown component: "+e+".";var s=!1;if(this._deferredCompRemovals.forEach(function(n){n.id===t&&n.comp===e&&(s=!0)}),s&&c(this),o.hash[t]&&!i.multi)throw"Entity already has component: "+e+".";var a={};if(a.__id=t,r(a,i.state),r(a,n),a.__id=t,i.multi){var u=o.hash[t];u||(u=[],o.hash[t]=u,o.list.push(u),o.map[t]=o.list.length-1),u.push(a)}else o.hash[t]=a,o.list.push(a),o.map[t]=o.list.length-1;return i.onAdd&&i.onAdd(t,a),this},i.prototype.hasComponent=function(t,e){var n=this._data[e];if(!n)throw"Unknown component: "+e+".";return void 0!==n.hash[t]},i.prototype.removeComponent=function(t,e,n){var r=this.components[e],i=this._data[e];if(!i)throw"Unknown component: "+e+".";if(!i.hash[t]){if(r.multi)return this;throw"Entity does not have component: "+e+"."}return n?l(this,t,e):(this._deferredCompRemovals.push({id:t,comp:e}),s(this)),this},i.prototype.getState=function(t,e){var n=this._data[e];if(!n)throw"Unknown component: "+e+".";return n.hash[t]},i.prototype.getStateAccessor=function(t){if(!this._data[t])throw"Unknown component: "+t+".";var e=this._data[t].hash;return function(t){return e[t]}},i.prototype.getComponentAccessor=function(t){if(!this._data[t])throw"Unknown component: "+t+".";var e=this._data[t].hash;return function(t){return void 0!==e[t]}},i.prototype.getStatesList=function(t){var e=this._data[t];if(!e)throw"Unknown component: "+t+".";return e.list},i.prototype.tick=function(t){o(this);for(var e=this._systems,n=0;n<e.length;++n){var r=e[n],i=this._data[r].list;this.components[r].system(t,i)}return o(this),this},i.prototype.render=function(t){o(this);for(var e=this._renderSystems,n=0;n<e.length;++n){var r=e[n],i=this._data[r].list;this.components[r].renderSystem(t,i)}return o(this),this},i.prototype.removeMultiComponent=function(t,e,n,r){var i=this.components[e],o=this._data[e];if(!o)throw"Unknown component: "+e+".";if(!i.multi)throw"removeMultiComponent called on non-multi component";var s=o.hash[t];if(!s||!s[n])throw"Multicomponent "+e+" instance not found at index "+n;var a=s[n];return r?h(this,t,e,a):this._deferredMultiCompRemovals.push({id:t,comp:e,state:a}),this}},function(t,e,n){"use strict";var r=n(0);t.exports=function(t){var e=!1;return{name:"position",state:{position:null,renderPosition:null,width:0,height:0,_extents:null,_extentsChanged:!0},onAdd:function(t,n){n.position?n.position instanceof Float32Array||e||(console.warn('Better to set entity positions as instances of "gl-vec3"!'),e=!0):n.position=r.create(),n.renderPosition=r.create(),r.copy(n.renderPosition,n.position),n._extents=new Float32Array(6)},onRemove:null,system:function(t,e){e.forEach(t=>{t._extentsChanged&&(!function(t,e,n,r){var i=r/2;t[0]=e[0]-i,t[1]=e[1],t[2]=e[2]-i,t[3]=e[0]+i,t[4]=e[1]+n,t[5]=e[2]+i}(t._extents,t.position,t.height,t.width),t._extentsChanged=!1)})}}}},function(t,e,n){"use strict";var r=n(0);t.exports=function(t){return{name:"physics",state:{body:null},onAdd:function(e,n){n.body=t.physics.addBody();var r=t.ents.getPositionData(n.__id);t.ents.setEntitySize(n.__id,r.width,r.height,r.width)},onRemove:function(e,n){if(t.ents.hasPosition(n.__id)){var r=t.ents.getPositionData(n.__id);s(n,r),a(n,r,0,!1)}t.physics.removeBody(n.body)},system:function(e,n){n.forEach(e=>{s(e,t.ents.getPositionData(e.__id))})},renderSystem:function(e,n){var r=-(t._tickRate-e)/1e3;n.forEach(e=>{var n=e.__id,i=t.ents.getPositionData(n),o=t.ents.cameraSmoothed(n);a(e,i,r,o)})}}};var i=r.create(),o=r.create();function s(t,e){i[0]=i[2]=e.width/2,i[1]=0;for(var n=e.position,r=t.body.aabb.base,o=t.body.aabb.max,s=e._extents,a=0;a<3;a++)n[a]=r[a]+i[a],s[a]=r[a],s[a+3]=o[a]}function a(t,e,n,i){r.scaleAndAdd(o,e.position,t.body.velocity,n),i&&r.lerp(o,e.renderPosition,o,.3),r.copy(e.renderPosition,o)}},function(t,e,n){"use strict";var r=n(0);t.exports=function(t){return{name:"followsEntity",state:{entity:0,offset:null},onAdd:function(t,i){var o=r.create();i.offset=i.offset?r.copy(o,i.offset):o,e(i),n(i)},onRemove:null,system:function(t,n){n.forEach(t=>{e(t)})},renderSystem:function(t,e){e.forEach(t=>{n(t)})}};function e(e){var n=e.__id,i=t.ents.getPositionData(n),o=t.ents.getPositionData(e.entity);o?r.add(i.position,o.position,e.offset):t.ents.removeComponent(n,t.ents.names.followsEntity)}function n(e){var n=e.__id,i=t.ents.getPositionData(n),o=t.ents.getPositionData(e.entity);o?r.add(i.renderPosition,o.renderPosition,e.offset):t.ents.removeComponent(n,t.ents.names.followsEntity)}}},function(t,e,n){"use strict";var r=n(0);t.exports=function(t){return{name:"mesh",state:{mesh:null,offset:null},onAdd:function(e,n){if(!n.mesh)throw new Error("Mesh component added without a mesh - probably a bug!");t.rendering.addMeshToScene(n.mesh),n.offset||(n.offset=new r.create);var i=t.ents.getPosition(e),o=n.mesh.position;o.x=i[0]+n.offset[0],o.y=i[1]+n.offset[1],o.z=i[2]+n.offset[2]},onRemove:function(t,e){e.mesh.dispose()},system:null,renderSystem:function(e,n){n.forEach(e=>{var n=e.__id,r=t.ents.getPositionData(n).renderPosition,i=r[0]+e.offset[0],o=r[1]+e.offset[1],s=r[2]+e.offset[2];e.mesh.position.copyFromFloats(i,o,s)})}}}},function(t,e,n){"use strict";var r,i=n(0);t.exports=function(t,e){r=e;var n=t.rendering.getScene(),u=BABYLON.Mesh.CreateDisc("shadow",.75,30,n);return u.rotation.x=Math.PI/2,u.material=t.rendering.makeStandardMaterial("shadowMat"),u.material.diffuseColor=BABYLON.Color3.Black(),u.material.ambientColor=BABYLON.Color3.Black(),u.material.alpha=.5,u.setEnabled(!1),n.removeMesh(u),{name:"shadow",state:{size:.5,_mesh:null},onAdd:function(e,n){n._mesh=t.rendering.makeMeshInstance(u,!1)},onRemove:function(t,e){e._mesh.dispose()},system:function(e,n){var u=t.rendering.getCameraPosition();i.set(s,u.x,u.y,u.z);var c=r;n.forEach(e=>{!function(t,e,n,r,u){var c,l=u.entities,h=l.getPositionData(t),f=h.position;if(l.hasPhysics(t)&&l.getPhysicsBody(t).resting[1]<0)c=h.renderPosition[1];else{var p=u.pick(f,o,r);if(!p)return void e.setEnabled(!1);c=p.position[1]}c=Math.round(c),i.set(a,e.position.x,c,e.position.z);var d=.01+i.squaredDistance(s,a)/1600*.1;d>.1&&(d=.1);e.position.y=c+d;var m=f[1]-c,v=.7*n*(1-m/r);e.scaling.copyFromFloats(v,v,v),e.setEnabled(!0)}(e.__id,e._mesh,e.size,c,t)})},renderSystem:function(e,n){n.forEach(e=>{var n=t.ents.getPositionData(e.__id).renderPosition,r=e._mesh.position;r.x=n[0],r.z=n[2]})}}};var o=i.fromValues(0,-1,0),s=i.fromValues(0,0,0),a=i.fromValues(0,0,0)},function(t,e,n){"use strict";t.exports=function(t){return{name:"collideTerrain",state:{callback:null},onAdd:function(e,n){var r=t.entities;r.hasPhysics(e)&&(r.getPhysicsBody(e).onCollide=function(n){var r=t.ents.getCollideTerrain(e).callback;r&&r(n,e)})},onRemove:function(e,n){var r=t.entities;r.hasPhysics(e)&&(r.getPhysicsBody(e).onCollide=null)},system:null}}},function(t,e,n){"use strict";var r=n(99);n(0);t.exports=function(t){return{name:"collideEntities",state:{cylinder:!1,collideBits:1,collideMask:1,callback:null},onAdd:null,onRemove:null,system:function(n,i){for(var o=t.ents,s=[],a=0;a<i.length;a++){var u=i[a].__id,c=o.getPositionData(u);s[a]=c._extents}r(s,function(n,r){var o=i[n],a=i[r];(function(t,n,r,i){if(t.cylinder)return n.cylinder?function(t,e){var n=(t[3]-t[0])/2,r=(e[3]-e[0])/2,i=t[0]+n-(e[0]+r),o=t[2]+n-(e[2]+r),s=n+r;return i*i+o*o<=s*s}(r,i):e(r,i);if(n.cylinder)return e(i,r);return!0})(o,a,s[n],s[r])&&function(t,e,n){var r=e.__id,i=n.__id;e.collideMask&n.collideBits&&e.callback&&e.callback(i);n.collideMask&e.collideBits&&n.callback&&n.callback(r);t.ents.onPairwiseEntityCollision(r,i)}(t,o,a)})}};function e(t,e){var r=(t[3]-t[0])/2,i=t[0]+r,o=t[2]+r,s=n(i,e[0],e[3])-i,a=n(o,e[2],e[5])-o;return s*s+a*a<=r*r}function n(t,e,n){return t<e?e:t>n?n:t}}},function(t,e,n){"use strict";t.exports=function(t,e,n){switch(arguments.length){case 1:return function(t){return r=[],c(t,t,l,!0),r}(t);case 2:return"function"==typeof e?c(t,t,e,!0):function(t,e){return r=[],c(t,e,l,!1),r}(t,e);case 3:return c(t,e,n,!1);default:throw new Error("box-intersect: Invalid arguments")}};var r,i=n(6),o=n(24),s=n(106);function a(t,e){for(var n=0;n<t;++n)if(!(e[n]<=e[n+t]))return!0;return!1}function u(t,e,n,r){for(var i=0,o=0,s=0,u=t.length;s<u;++s){var c=t[s];if(!a(e,c)){for(var l=0;l<2*e;++l)n[i++]=c[l];r[o++]=s}}return o}function c(t,e,n,r){var a=t.length,c=e.length;if(!(a<=0||c<=0)){var l=t[0].length>>>1;if(!(l<=0)){var h,f=i.mallocDouble(2*l*a),p=i.mallocInt32(a);if((a=u(t,l,f,p))>0){if(1===l&&r)o.init(a),h=o.sweepComplete(l,n,0,a,f,p,0,a,f,p);else{var d=i.mallocDouble(2*l*c),m=i.mallocInt32(c);(c=u(e,l,d,m))>0&&(o.init(a+c),h=1===l?o.sweepBipartite(l,n,0,a,f,p,0,c,d,m):s(l,n,r,a,f,p,c,d,m),i.free(d),i.free(m))}i.free(f),i.free(p)}return h}}}function l(t,e){r.push([t,e])}},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(101),i=n(102),o=n(103);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return c(this,t,e,n)}function c(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=f(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(e,n),i=(t=a(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(u.isBuffer(e)){var n=0|p(e.length);return 0===(t=a(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?a(t,0):f(t,e);if("Buffer"===e.type&&o(e.data))return f(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(l(e),t=a(t,e<0?0:0|p(e)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function f(t,e){var n=e.length<0?0:0|p(e.length);t=a(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function p(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function d(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Y(t).length;default:if(r)return U(t).length;e=(""+e).toLowerCase(),r=!0}}function m(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function v(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=u.from(e,r)),u.isBuffer(e))return 0===e.length?-1:g(t,e,n,r,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):g(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function g(t,e,n,r,i){var o,s=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var h=!0,f=0;f<u;f++)if(c(t,o+f)!==c(e,f)){h=!1;break}if(h)return o}return-1}function y(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function _(t,e,n,r){return N(U(e,t.length-n),t,n,r)}function w(t,e,n,r){return N(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function b(t,e,n,r){return w(t,e,n,r)}function k(t,e,n,r){return N(Y(e),t,n,r)}function M(t,e,n,r){return N(function(t,e){for(var n,r,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function x(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function A(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,s,a,u,c=t[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(t){var e=t.length;if(e<=E)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=E));return n}(r)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,n){return c(null,t,e,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,n){return function(t,e,n,r){return l(e),e<=0?a(t,e):void 0!==n?"string"==typeof r?a(t,e).fill(n,r):a(t,e).fill(n):a(t,e)}(null,t,e,n)},u.allocUnsafe=function(t){return h(null,t)},u.allocUnsafeSlow=function(t){return h(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=u.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var s=t[n];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)m(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?A(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return D(this,e,n);case"utf8":case"utf-8":return A(this,e,n);case"ascii":return B(this,e,n);case"latin1":case"binary":return C(this,e,n);case"base64":return x(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,n,r,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var o=i-r,s=n-e,a=Math.min(o,s),c=this.slice(r,i),l=t.slice(e,n),h=0;h<a;++h)if(c[h]!==l[h]){o=c[h],s=l[h];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},u.prototype.indexOf=function(t,e,n){return v(this,t,e,n,!0)},u.prototype.lastIndexOf=function(t,e,n){return v(this,t,e,n,!1)},u.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return y(this,t,e,n);case"utf8":case"utf-8":return _(this,t,e,n);case"ascii":return w(this,t,e,n);case"latin1":case"binary":return b(this,t,e,n);case"base64":return k(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function B(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function C(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function D(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=z(t[o]);return i}function P(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function S(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,n,r,i,o){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function T(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function I(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function O(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(t,e,n,r,o){return o||O(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function j(t,e,n,r,o){return o||O(t,0,n,8),i.write(t,e,n,r,52,8),n+8}u.prototype.slice=function(t,e){var n,r=this.length;if(t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;n=new u(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},u.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||S(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},u.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||S(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},u.prototype.readUInt8=function(t,e){return e||S(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||S(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||S(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||S(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||S(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||S(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},u.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||S(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||S(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||S(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(t,e){e||S(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(t,e){return e||S(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||S(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||S(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||S(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||S(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||S(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||L(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},u.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||L(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},u.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):T(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):T(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):I(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);L(this,t,e,n,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},u.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);L(this,t,e,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},u.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):T(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):T(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):I(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,n){return R(this,t,e,!0,n)},u.prototype.writeFloatBE=function(t,e,n){return R(this,t,e,!1,n)},u.prototype.writeDoubleLE=function(t,e,n){return j(this,t,e,!0,n)},u.prototype.writeDoubleBE=function(t,e,n){return j(this,t,e,!1,n)},u.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},u.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=u.isBuffer(t)?t:U(new u(t,r).toString()),a=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%a]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function z(t){return t<16?"0"+t.toString(16):t.toString(16)}function U(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],s=0;s<r;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Y(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(F,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function N(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(5))},function(t,e,n){"use strict";e.byteLength=function(t){var e=c(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){for(var e,n=c(t),r=n[0],s=n[1],a=new o(function(t,e,n){return 3*(e+n)/4-n}(0,r,s)),u=0,l=s>0?r-4:r,h=0;h<l;h+=4)e=i[t.charCodeAt(h)]<<18|i[t.charCodeAt(h+1)]<<12|i[t.charCodeAt(h+2)]<<6|i[t.charCodeAt(h+3)],a[u++]=e>>16&255,a[u++]=e>>8&255,a[u++]=255&e;2===s&&(e=i[t.charCodeAt(h)]<<2|i[t.charCodeAt(h+1)]>>4,a[u++]=255&e);1===s&&(e=i[t.charCodeAt(h)]<<10|i[t.charCodeAt(h+1)]<<4|i[t.charCodeAt(h+2)]>>2,a[u++]=e>>8&255,a[u++]=255&e);return a},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(h(t,s,s+16383>a?a:s+16383));1===i?(e=t[n-1],o.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],o.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function l(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function h(t,e,n){for(var r,i=[],o=e;o<n;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(l(r));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,h=n?i-1:0,f=n?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+h],h+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+t[e+h],h+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(s++,u/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(e*u-1)*Math.pow(2,i),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;t[n+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;t[n+p]=255&s,p+=d,s/=256,c-=8);t[n+p-d]|=128*m}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){"use strict";t.exports=function(t,e){switch(void 0===e&&(e=0),typeof t){case"number":if(t>0)return function(t,e){var n,r;for(n=new Array(t),r=0;r<t;++r)n[r]=e;return n}(0|t,e);break;case"object":if("number"==typeof t.length)return function t(e,n,r){var i=0|e[r];if(i<=0)return[];var o,s=new Array(i);if(r===e.length-1)for(o=0;o<i;++o)s[o]=n;else for(o=0;o<i;++o)s[o]=t(e,n,r+1);return s}(t,e,0)}return[]}},function(t,e,n){"use strict";t.exports=function(t,e){e<=4*r?i(0,e-1,t):function t(e,n,h){var f=(n-e+1)/6|0,p=e+f,d=n-f,m=e+n>>1,v=m-f,g=m+f,y=p,_=v,w=m,b=g,k=d,M=e+1,x=n-1,A=0;c(y,_,h)&&(A=y,y=_,_=A);c(b,k,h)&&(A=b,b=k,k=A);c(y,w,h)&&(A=y,y=w,w=A);c(_,w,h)&&(A=_,_=w,w=A);c(y,b,h)&&(A=y,y=b,b=A);c(w,b,h)&&(A=w,w=b,b=A);c(_,k,h)&&(A=_,_=k,k=A);c(_,w,h)&&(A=_,_=w,w=A);c(b,k,h)&&(A=b,b=k,k=A);var E=h[2*_];var B=h[2*_+1];var C=h[2*b];var D=h[2*b+1];var P=2*y;var S=2*w;var L=2*k;var T=2*p;var I=2*m;var O=2*d;for(var R=0;R<2;++R){var j=h[P+R],F=h[S+R],z=h[L+R];h[T+R]=j,h[I+R]=F,h[O+R]=z}s(v,e,h);s(g,n,h);for(var U=M;U<=x;++U)if(l(U,E,B,h))U!==M&&o(U,M,h),++M;else if(!l(U,C,D,h))for(;;){if(l(x,C,D,h)){l(x,E,B,h)?(a(U,M,x,h),++M,--x):(o(U,x,h),--x);break}if(--x<U)break}u(e,M-1,E,B,h);u(n,x+1,C,D,h);M-2-e<=r?i(e,M-2,h):t(e,M-2,h);n-(x+2)<=r?i(x+2,n,h):t(x+2,n,h);x-M<=r?i(M,x,h):t(M,x,h)}(0,e-1,t)};var r=32;function i(t,e,n){for(var r=2*(t+1),i=t+1;i<=e;++i){for(var o=n[r++],s=n[r++],a=i,u=r-2;a-- >t;){var c=n[u-2],l=n[u-1];if(c<o)break;if(c===o&&l<s)break;n[u]=c,n[u+1]=l,u-=2}n[u]=o,n[u+1]=s}}function o(t,e,n){e*=2;var r=n[t*=2],i=n[t+1];n[t]=n[e],n[t+1]=n[e+1],n[e]=r,n[e+1]=i}function s(t,e,n){e*=2,n[t*=2]=n[e],n[t+1]=n[e+1]}function a(t,e,n,r){e*=2,n*=2;var i=r[t*=2],o=r[t+1];r[t]=r[e],r[t+1]=r[e+1],r[e]=r[n],r[e+1]=r[n+1],r[n]=i,r[n+1]=o}function u(t,e,n,r,i){e*=2,i[t*=2]=i[e],i[e]=n,i[t+1]=i[e+1],i[e+1]=r}function c(t,e,n){e*=2;var r=n[t*=2],i=n[e];return!(r<i)&&(r!==i||n[t+1]>n[e+1])}function l(t,e,n,r){var i=r[t*=2];return i<e||i===e&&r[t+1]<n}},function(t,e,n){"use strict";t.exports=function(t,e,n,o,l,B,C,D,P){!function(t,e){var n=8*i.log2(e+1)*(t+1)|0,o=i.nextPow2(w*n);k.length<o&&(r.free(k),k=r.mallocInt32(o));var s=i.nextPow2(b*n);M<s&&(r.free(M),M=r.mallocDouble(s))}(t,o+C);var S,L=0,T=2*t;x(L++,0,0,o,0,C,n?16:0,-1/0,1/0),n||x(L++,0,0,C,0,o,1,-1/0,1/0);for(;L>0;){var I=(L-=1)*w,O=k[I],R=k[I+1],j=k[I+2],F=k[I+3],z=k[I+4],U=k[I+5],Y=L*b,N=M[Y],q=M[Y+1],H=1&U,X=!!(16&U),V=l,Z=B,J=D,K=P;if(H&&(V=D,Z=P,J=l,K=B),!(2&U&&(j=v(t,O,R,j,V,Z,q),R>=j)||4&U&&(R=g(t,O,R,j,V,Z,N))>=j)){var G=j-R,W=z-F;if(X){if(t*G*(G+W)<p){if(void 0!==(S=u.scanComplete(t,O,e,R,j,V,Z,F,z,J,K)))return S;continue}}else{if(t*Math.min(G,W)<h){if(void 0!==(S=s(t,O,e,H,R,j,V,Z,F,z,J,K)))return S;continue}if(t*G*W<f){if(void 0!==(S=u.scanBipartite(t,O,e,H,R,j,V,Z,F,z,J,K)))return S;continue}}var Q=d(t,O,R,j,V,Z,N,q);if(R<Q)if(t*(Q-R)<h){if(void 0!==(S=a(t,O+1,e,R,Q,V,Z,F,z,J,K)))return S}else if(O===t-2){if(void 0!==(S=H?u.sweepBipartite(t,e,F,z,J,K,R,Q,V,Z):u.sweepBipartite(t,e,R,Q,V,Z,F,z,J,K)))return S}else x(L++,O+1,R,Q,F,z,H,-1/0,1/0),x(L++,O+1,F,z,R,Q,1^H,-1/0,1/0);if(Q<j){var $=c(t,O,F,z,J,K),tt=J[T*$+O],et=m(t,O,$,z,J,K,tt);if(et<z&&x(L++,O,Q,j,et,z,(4|H)+(X?16:0),tt,q),F<$&&x(L++,O,Q,j,F,$,(2|H)+(X?16:0),N,tt),$+1===et){if(void 0!==(S=X?E(t,O,e,Q,j,V,Z,$,J,K[$]):A(t,O,e,H,Q,j,V,Z,$,J,K[$])))return S}else if($<et){var nt;if(X){if(nt=y(t,O,Q,j,V,Z,tt),Q<nt){var rt=m(t,O,Q,nt,V,Z,tt);if(O===t-2){if(Q<rt&&void 0!==(S=u.sweepComplete(t,e,Q,rt,V,Z,$,et,J,K)))return S;if(rt<nt&&void 0!==(S=u.sweepBipartite(t,e,rt,nt,V,Z,$,et,J,K)))return S}else Q<rt&&x(L++,O+1,Q,rt,$,et,16,-1/0,1/0),rt<nt&&(x(L++,O+1,rt,nt,$,et,0,-1/0,1/0),x(L++,O+1,$,et,rt,nt,1,-1/0,1/0))}}else nt=H?_(t,O,Q,j,V,Z,tt):y(t,O,Q,j,V,Z,tt),Q<nt&&(O===t-2?S=H?u.sweepBipartite(t,e,$,et,J,K,Q,nt,V,Z):u.sweepBipartite(t,e,Q,nt,V,Z,$,et,J,K):(x(L++,O+1,Q,nt,$,et,H,-1/0,1/0),x(L++,O+1,$,et,Q,nt,1^H,-1/0,1/0)))}}}}};var r=n(6),i=n(7),o=n(107),s=o.partial,a=o.full,u=n(24),c=n(108),l=n(25),h=128,f=1<<22,p=1<<22,d=l("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),m=l("lo===p0",["p0"]),v=l("lo<p0",["p0"]),g=l("hi<=p0",["p0"]),y=l("lo<=p0&&p0<=hi",["p0"]),_=l("lo<p0&&p0<=hi",["p0"]),w=6,b=2,k=r.mallocInt32(1024),M=r.mallocDouble(1024);function x(t,e,n,r,i,o,s,a,u){var c=w*t;k[c]=e,k[c+1]=n,k[c+2]=r,k[c+3]=i,k[c+4]=o,k[c+5]=s;var l=b*t;M[l]=a,M[l+1]=u}function A(t,e,n,r,i,o,s,a,u,c,l){var h=2*t,f=u*h,p=c[f+e];t:for(var d=i,m=i*h;d<o;++d,m+=h){var v=s[m+e],g=s[m+e+t];if(!(p<v||g<p)&&(!r||p!==v)){for(var y,_=a[d],w=e+1;w<t;++w){v=s[m+w],g=s[m+w+t];var b=c[f+w],k=c[f+w+t];if(g<b||k<v)continue t}if(void 0!==(y=r?n(l,_):n(_,l)))return y}}}function E(t,e,n,r,i,o,s,a,u,c){var l=2*t,h=a*l,f=u[h+e];t:for(var p=r,d=r*l;p<i;++p,d+=l){var m=s[p];if(m!==c){var v=o[d+e],g=o[d+e+t];if(!(f<v||g<f)){for(var y=e+1;y<t;++y){v=o[d+y],g=o[d+y+t];var _=u[h+y],w=u[h+y+t];if(g<_||w<v)continue t}var b=n(m,c);if(void 0!==b)return b}}}}},function(t,e,n){"use strict";var r="d",i="ax",o="vv",s="fp",a="es",u="rs",c="re",l="rb",h="ri",f="rp",p="bs",d="be",m="bb",v="bi",g="bp",y="rv",_="Q",w=[r,i,o,u,c,l,h,p,d,m,v];function b(t){var e="bruteForce"+(t?"Full":"Partial"),n=[],b=w.slice();t||b.splice(3,0,s);var k=["function "+e+"("+b.join()+"){"];function M(e,s){var b=function(t,e,n){var s="bruteForce"+(t?"Red":"Blue")+(e?"Flip":"")+(n?"Full":""),b=["function ",s,"(",w.join(),"){","var ",a,"=2*",r,";"],k="for(var i="+u+","+f+"="+a+"*"+u+";i<"+c+";++i,"+f+"+="+a+"){var x0="+l+"["+i+"+"+f+"],x1="+l+"["+i+"+"+f+"+"+r+"],xi="+h+"[i];",M="for(var j="+p+","+g+"="+a+"*"+p+";j<"+d+";++j,"+g+"+="+a+"){var y0="+m+"["+i+"+"+g+"],"+(n?"y1="+m+"["+i+"+"+g+"+"+r+"],":"")+"yi="+v+"[j];";return t?b.push(k,_,":",M):b.push(M,_,":",k),n?b.push("if(y1<x0||x1<y0)continue;"):e?b.push("if(y0<=x0||x1<y0)continue;"):b.push("if(y0<x0||x1<y0)continue;"),b.push("for(var k="+i+"+1;k<"+r+";++k){var r0="+l+"[k+"+f+"],r1="+l+"[k+"+r+"+"+f+"],b0="+m+"[k+"+g+"],b1="+m+"[k+"+r+"+"+g+"];if(r1<b0||b1<r0)continue "+_+";}var "+y+"="+o+"("),e?b.push("yi,xi"):b.push("xi,yi"),b.push(");if("+y+"!==void 0)return "+y+";}}}"),{name:s,code:b.join("")}}(e,s,t);n.push(b.code),k.push("return "+b.name+"("+w.join()+");")}k.push("if("+c+"-"+u+">"+d+"-"+p+"){"),t?(M(!0,!1),k.push("}else{"),M(!1,!1)):(k.push("if("+s+"){"),M(!0,!0),k.push("}else{"),M(!0,!1),k.push("}}else{if("+s+"){"),M(!1,!0),k.push("}else{"),M(!1,!1),k.push("}")),k.push("}}return "+e);var x=n.join("")+k.join("");return new Function(x)()}e.partial=b(!1),e.full=b(!0)},function(t,e,n){"use strict";t.exports=function(t,e,n,s,a,u){if(s<=n+1)return n;var c=n,l=s,h=s+n>>>1,f=2*t,p=h,d=a[f*h+e];for(;c<l;){if(l-c<i){o(t,e,c,l,a,u),d=a[f*h+e];break}var m=l-c,v=Math.random()*m+c|0,g=a[f*v+e],y=Math.random()*m+c|0,_=a[f*y+e],w=Math.random()*m+c|0,b=a[f*w+e];g<=_?b>=_?(p=y,d=_):g>=b?(p=v,d=g):(p=w,d=b):_>=b?(p=y,d=_):b>=g?(p=v,d=g):(p=w,d=b);for(var k=f*(l-1),M=f*p,x=0;x<f;++x,++k,++M){var A=a[k];a[k]=a[M],a[M]=A}var E=u[l-1];u[l-1]=u[p],u[p]=E,p=r(t,e,c,l-1,a,u,d);for(var k=f*(l-1),M=f*p,x=0;x<f;++x,++k,++M){var A=a[k];a[k]=a[M],a[M]=A}var E=u[l-1];if(u[l-1]=u[p],u[p]=E,h<p){for(l=p-1;c<l&&a[f*(l-1)+e]===d;)l-=1;l+=1}else{if(!(p<h))break;for(c=p+1;c<l&&a[f*c+e]===d;)c+=1}}return r(t,e,n,h,a,u,a[f*h+e])};var r=n(25)("lo<p0",["p0"]),i=8;function o(t,e,n,r,i,o){for(var s=2*t,a=s*(n+1)+e,u=n+1;u<r;++u,a+=s)for(var c=i[a],l=u,h=s*(u-1);l>n&&i[h+e]>c;--l,h-=s){for(var f=h,p=h+s,d=0;d<s;++d,++f,++p){var m=i[f];i[f]=i[p],i[p]=m}var v=o[l];o[l]=o[l-1],o[l-1]=v}}},function(t,e,n){"use strict";t.exports=function(t){return{name:"smooth-camera",state:{time:100.1},onAdd:null,onRemove:null,system:function(e,n){n.forEach(n=>{n.time-=e,n.time<0&&t.ents.removeComponent(n.__id,"smooth-camera")})}}}},function(t,e,n){"use strict";var r=n(0);t.exports=function(t){return{name:"movement",state:{heading:0,running:!1,jumping:!1,maxSpeed:10,moveForce:30,responsiveness:15,runningFriction:0,standingFriction:2,airMoveMult:.5,jumpImpulse:10,jumpForce:12,jumpTime:500,airJumps:1,_jumpCount:0,_isJumping:0,_currjumptime:0},onAdd:null,onRemove:null,system:function(e,n){var a=t.entities;n.forEach(t=>{var n=a.getPhysicsBody(t.__id);!function(t,e,n){var a=n.atRestY()<0,u=a||e._jumpCount<e.airJumps;a&&(e._isJumping=!1,e._jumpCount=0);if(e.jumping)if(e._isJumping){if(e._currjumptime>0){var c=e.jumpForce;e._currjumptime<t&&(c*=e._currjumptime/t),n.applyForce([0,c,0]),e._currjumptime-=t}}else u&&(e._isJumping=!0,a||e._jumpCount++,e._currjumptime=e.jumpTime,n.applyImpulse([0,e.jumpImpulse,0]),!a&&n.velocity[1]<0&&(n.velocity[1]=0));else e._isJumping=!1;var l=i,h=o;if(e.running){var f=e.maxSpeed;r.set(l,0,0,f),r.rotateY(l,l,s,e.heading),r.subtract(h,l,n.velocity),h[1]=0;var p=r.length(h);if(r.normalize(h,h),p>0){var d=e.moveForce;a||(d*=e.airMoveMult);var m=e.responsiveness*p;d>m&&(d=m),r.scale(h,h,d),n.applyForce(h)}n.friction=e.runningFriction}else n.friction=e.standingFriction}(e,t,n)})}}};var i=r.create(),o=r.create(),s=r.create()},function(t,e,n){"use strict";t.exports=function(t){return{name:"receivesInputs",state:{},onAdd:null,onRemove:null,system:function(e,n){var r=t.entities,i=t.inputs.state,o=t.rendering.getCameraRotation()[1];n.forEach(t=>{!function(t,e,n){t.jumping=!!e.jump;var r=e.forward?e.backward?0:1:e.backward?-1:0,i=e.right?e.left?0:1:e.left?-1:0;0==(r|i)?t.running=!1:(t.running=!0,r?(-1==r&&(n+=Math.PI),i&&(n+=Math.PI/4*r*i)):n+=i*Math.PI/2,t.heading=n)}(r.getMovement(t.__id),i,o)})}}}},function(t,e,n){"use strict";t.exports=function(t){return{name:"fadeOnZoom",state:{cutoff:1.5,_showing:!0},onAdd:null,onRemove:null,system:function(e,n){var r=t.rendering._currentZoom,i=t.entities;n.forEach(t=>{!function(t,e,n,r){if(!r.hasMesh(e))return;if(t._showing&&n<t.cutoff||!t._showing&&n>t.cutoff){var i=r.getMeshData(e).mesh;i.visibility=t._showing=n>t.cutoff}}(t,t.__id,r,i)})}}}},function(t,e,n){"use strict";t.exports=function(t,e,n,r,i,o){var s=+e[0],a=+e[1],u=+e[2],c=+n[0],l=+n[1],h=+n[2],f=Math.sqrt(c*c+l*l+h*h);if(0===f)throw new Error("Can't raycast along a zero vector");return function(t,e,n,r,i,o,s,a,u,c){for(var l=0,h=Math.floor,f=0|h(e),p=0|h(n),d=0|h(r),m=i>0?1:-1,v=o>0?1:-1,g=s>0?1:-1,y=Math.abs(1/i),_=Math.abs(1/o),w=Math.abs(1/s),b=y<1/0?y*(m>0?f+1-e:e-f):1/0,k=_<1/0?_*(v>0?p+1-n:n-p):1/0,M=w<1/0?w*(g>0?d+1-r:r-d):1/0,x=-1;l<=a;){var A=t(f,p,d);if(A)return u&&(u[0]=e+l*i,u[1]=n+l*o,u[2]=r+l*s),c&&(c[0]=c[1]=c[2]=0,0===x&&(c[0]=-m),1===x&&(c[1]=-v),2===x&&(c[2]=-g)),A;b<k?b<M?(f+=m,l=b,b+=y,x=0):(d+=g,l=M,M+=w,x=2):k<M?(p+=v,l=k,k+=_,x=1):(d+=g,l=M,M+=w,x=2)}return u&&(u[0]=e+l*i,u[1]=n+l*o,u[2]=r+l*s),c&&(c[0]=c[1]=c[2]=0),0}(t,s,a,u,c/=f,l/=f,h/=f,r=void 0===r?64:+r,i,o)}}]);